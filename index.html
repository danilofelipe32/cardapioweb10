<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Black Burger - Cardápio Digital</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Netflix Sans Variable"', '-apple-system', 'BlinkMacSystemFont', '"Segoe UI"', 'Roboto', '"Helvetica Neue"', 'Arial', 'sans-serif'],
                        mono: ['"Courier New"', 'monospace'],
                        serif: ['"Georgia"', 'serif'],
                    },
                    colors: {
                        border: "var(--border)",
                        input: "var(--input)",
                        ring: "var(--ring)",
                        background: "var(--background)",
                        foreground: "var(--foreground)",
                        primary: {
                            DEFAULT: "var(--primary)",
                            foreground: "var(--primary-foreground)",
                        },
                        secondary: {
                            DEFAULT: "var(--secondary)",
                            foreground: "var(--secondary-foreground)",
                        },
                        destructive: {
                            DEFAULT: "var(--destructive)",
                            foreground: "var(--destructive-foreground)",
                        },
                        muted: {
                            DEFAULT: "var(--muted)",
                            foreground: "var(--muted-foreground)",
                        },
                        accent: {
                            DEFAULT: "var(--accent)",
                            foreground: "var(--accent-foreground)",
                        },
                        popover: {
                            DEFAULT: "var(--popover)",
                            foreground: "var(--popover-foreground)",
                        },
                        card: {
                            DEFAULT: "var(--card)",
                            foreground: "var(--card-foreground)",
                        },
                    },
                    borderRadius: {
                        lg: "var(--radius)",
                        md: "calc(var(--radius) - 2px)",
                        sm: "calc(var(--radius) - 4px)",
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'pulse-slow': 'pulseInterval 5s ease-in-out infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'shimmer': 'shimmer 2s linear infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        pulseInterval: {
                             '0%, 100%': { transform: 'scale(1)', filter: 'brightness(1)' },
                             '10%': { transform: 'scale(1.02)', filter: 'brightness(1.1)' },
                             '20%': { transform: 'scale(1)' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        },
                        shimmer: {
                            '0%': { backgroundPosition: '-200% 0' },
                            '100%': { backgroundPosition: '200% 0' }
                        }
                    }
                }
            }
        }
    </script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- QR Code Generator Lib -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        :root {
            --card: #f9fafb;
            --ring: #e50914;
            --input: #e5e7eb;
            --muted: #f9fafb;
            --accent: #fffbeb;
            --border: #e5e7eb;
            --radius: 0.25rem;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --popover: #ffffff;
            --primary: #e50914;
            --spacing: 0.25rem;
            --font-mono: "Courier New", monospace;
            --font-sans: "Netflix Sans Variable", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --secondary: #f3f4f6;
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --background: #ffffff;
            --font-serif: "Georgia", serif;
            --foreground: #000000;
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --destructive: #ef4444;
            --card-foreground: #171717;
            --muted-foreground: #6b7280;
            --accent-foreground: #92400e;
            --popover-foreground: #000000;
            --primary-foreground: #ffffff;
            --secondary-foreground: #4b5563;
            --destructive-foreground: #ffffff;
        }

        .dark {
            --card: #1a1a1a;
            --ring: #e50914;
            --input: #404040;
            --muted: #2b2b2b;
            --accent: #e50914;
            --border: #404040;
            --radius: 0.25rem;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --popover: #1a1a1a;
            --primary: #e50914;
            --spacing: 0.25rem;
            --font-mono: "Courier New", monospace;
            --font-sans: "Netflix Sans Variable", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --secondary: #2b2b2b;
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --background: #000000;
            --font-serif: "Georgia", serif;
            --foreground: #ffffff;
            --shadow-2xl: 0px 0.25rem 0.5rem 0px rgba(0, 0, 0, 0.8);
            --destructive: #e50914;
            --card-foreground: #ffffff;
            --muted-foreground: #a3a3a3;
            --accent-foreground: #ffffff;
            --popover-foreground: #ffffff;
            --primary-foreground: #ffffff;
            --secondary-foreground: #a3a3a3;
            --destructive-foreground: #ffffff;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--muted-foreground);
            border-radius: 4px;
            opacity: 0.5;
        }
        
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
        }
        input[type=range]:focus {
            outline: none; 
        }
        
        /* Smooth Image Loading */
        img {
            transition: opacity 0.3s ease-in-out;
        }
        
        /* Toggle Switch */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #10B981;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #10B981;
        }
        
        /* AI Response Styling - Markdown-like */
        .ai-response-content h1, .ai-response-content h2, .ai-response-content h3 { 
            font-weight: 800; 
            margin-top: 1.5em; 
            margin-bottom: 0.5em; 
            color: var(--foreground); 
            line-height: 1.2;
        }
        .ai-response-content h1 { font-size: 1.5em; }
        .ai-response-content h2 { font-size: 1.25em; border-bottom: 1px solid var(--border); padding-bottom: 0.25em; }
        .ai-response-content h3 { font-size: 1.1em; }
        
        .ai-response-content p { margin-bottom: 0.75em; line-height: 1.6; color: var(--muted-foreground); }
        
        .ai-response-content ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; }
        .ai-response-content li { margin-bottom: 0.25em; color: var(--muted-foreground); }
        
        .ai-response-content strong { color: var(--primary); font-weight: 700; }
        
        .ai-card-highlight {
            background-color: var(--secondary);
            border-radius: var(--radius);
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary);
        }
    </style>
</head>
<body class="text-foreground bg-background transition-colors duration-300 font-sans selection:bg-primary/30 selection:text-primary">

    <!-- Fundo com Vídeo e Fallback -->
    <div class="fixed inset-0 -z-50 w-full h-full overflow-hidden">
        <video autoplay loop muted playsinline class="absolute inset-0 w-full h-full object-cover">
            <source src="https://i.imgur.com/Tvbxj6Z.mp4" type="video/mp4">
        </video>
        <div class="absolute inset-0 bg-background/90 backdrop-blur-[2px] transition-colors duration-300"></div>
        <div class="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-primary/20 blur-[100px] rounded-full mix-blend-overlay animate-pulse-slow"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[600px] h-[600px] bg-accent/20 blur-[120px] rounded-full mix-blend-overlay animate-pulse-slow" style="animation-delay: 2s;"></div>
    </div>

    <!-- App Container -->
    <div id="app" class="relative min-h-screen flex flex-col">
        
        <!-- Aviso de Mesa Identificada -->
        <div id="table-badge" class="hidden bg-green-600 text-white text-center py-1 text-xs font-bold uppercase tracking-widest sticky top-0 z-[60] shadow-md animate-slide-up">
            <i data-lucide="map-pin" class="inline w-3 h-3 mb-0.5 mr-1"></i> Mesa <span id="table-number-display"></span> Identificada
        </div>

        <!-- Header -->
        <header class="sticky top-0 z-50 w-full bg-background/80 backdrop-blur-xl border-b border-border transition-all duration-300 shadow-sm" id="main-header">
            <div class="max-w-7xl mx-auto px-4 h-20 flex justify-between items-center">
                <div class="flex items-center gap-3 cursor-pointer group" onclick="closeDetails()">
                    <div class="bg-gradient-to-tr from-primary to-destructive p-2.5 rounded-xl shadow-lg group-hover:scale-110 group-hover:rotate-3 transition-all duration-300 ease-out">
                        <i data-lucide="chef-hat" class="text-primary-foreground w-5 h-5"></i>
                    </div>
                    <div class="flex flex-col -space-y-1">
                        <span class="text-xs font-bold text-muted-foreground tracking-[0.2em] uppercase">The Original</span>
                        <h1 class="text-2xl font-black tracking-tighter text-foreground group-hover:text-primary transition-colors">
                            BLACK<span class="text-primary transition-colors">BURGER</span>
                        </h1>
                        <!-- Tag de Horário (Atualizada via JS) -->
                        <div id="hours-badge" class="mt-0.5"></div>
                    </div>
                </div>

                <div class="flex items-center gap-2 md:gap-6">
                    <!-- Botão de Compartilhar -->
                    <button onclick="shareMenu()" class="p-2 rounded-full text-muted-foreground hover:bg-accent transition-all hover:scale-110 active:scale-95" title="Compartilhar">
                        <i data-lucide="share-2" class="w-5 h-5"></i>
                    </button>
                    
                    <button onclick="toggleTheme()" class="p-2 rounded-full text-muted-foreground hover:bg-accent transition-all hover:scale-110 active:scale-95">
                        <i id="theme-icon" data-lucide="moon" class="w-5 h-5"></i>
                    </button>
                    <button onclick="toggleCart()" class="flex items-center gap-3 group relative p-2 md:p-0">
                        <span class="hidden md:block text-sm font-medium text-muted-foreground group-hover:text-foreground transition-colors">Seu Pedido</span>
                        <div class="relative bg-secondary group-hover:bg-primary group-hover:text-primary-foreground text-foreground p-2.5 md:p-3 rounded-2xl transition-all duration-300 border border-border group-hover:border-primary group-hover:shadow-lg group-hover:-translate-y-1">
                            <i data-lucide="shopping-cart" class="w-5 h-5"></i>
                            <span id="cart-count" class="absolute -top-1.5 -right-1.5 bg-background text-primary text-[10px] font-black w-5 h-5 flex items-center justify-center rounded-full shadow-lg border border-primary hidden animate-bounce">0</span>
                        </div>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main id="main-view" class="flex-1 relative z-10">
            
            <!-- Hero Title & Promo Stack -->
            <section class="relative pt-12 pb-8 px-4 text-center overflow-hidden">
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[120%] h-full bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-primary/10 via-transparent to-transparent -z-10"></div>
                
                <div class="max-w-7xl mx-auto text-center">
                    <h2 class="text-4xl md:text-8xl font-black mb-4 tracking-tighter leading-[0.9] text-foreground animate-pulse-slow drop-shadow-sm">
                        SABOR QUE <br />
                        <span class="text-transparent bg-clip-text bg-gradient-to-b from-primary to-destructive">DOMINA</span>
                    </h2>
                    <p class="text-muted-foreground max-w-xl mx-auto text-base md:text-xl font-light">
                        Hambúrgueres artesanais feitos com paixão e ingredientes premium.
                    </p>
                </div>
            </section>

            <!-- Sticky Controls -->
            <section class="sticky top-20 z-40 bg-background/80 backdrop-blur-md border-y border-border shadow-sm transition-all duration-300 py-4" id="controls-section">
                <div class="max-w-7xl mx-auto px-4 space-y-4 flex flex-col items-center w-full">
                    <div class="relative max-w-md mx-auto w-full transition-all duration-300 group" id="search-container">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i data-lucide="search" class="h-5 w-5 text-muted-foreground group-focus-within:text-primary transition-colors"></i>
                        </div>
                        <input type="text" id="search-input" placeholder="Toque para buscar e filtrar..." class="block w-full pl-10 pr-10 py-3 border border-input rounded-xl leading-5 bg-background text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-all sm:text-sm shadow-sm focus:shadow-lg focus:scale-[1.02]" oninput="handleSearch(this.value)" onfocus="openSearchMode()">
                        <button onclick="closeSearchMode()" id="search-close-btn" class="absolute inset-y-0 right-0 pr-3 flex items-center hidden text-muted-foreground hover:text-primary transition-colors hover:rotate-90 duration-200">
                            <i data-lucide="x" class="h-5 w-5"></i>
                        </button>
                    </div>
                    <div id="search-filters-wrapper" class="hidden space-y-4 animate-fade-in w-full">
                        <div class="flex justify-center overflow-x-auto no-scrollbar pb-1 -mx-4 px-4 md:mx-0 w-full">
                            <div id="categories-container" class="inline-flex space-x-2"></div>
                        </div>
                        <div id="filters-container" class="flex flex-wrap justify-center gap-2 md:gap-3 w-full"></div>
                    </div>
                </div>
            </section>
            
            <!-- NOVA SEÇÃO: Promoções Especiais -->
            <section id="special-promos-section" class="hidden max-w-7xl mx-auto px-4 mt-8 animate-fade-in">
                <div class="flex items-center gap-2 mb-6 text-primary">
                    <i data-lucide="zap" class="w-6 h-6 fill-current animate-pulse"></i>
                    <h3 class="text-xl font-black uppercase tracking-wider text-foreground drop-shadow-sm">OFERTAS RELÂMPAGO</h3>
                </div>
                <div id="special-promos-grid" class="flex overflow-x-auto gap-6 py-6 px-2 no-scrollbar snap-x">
                    <!-- Injected by JS -->
                </div>
            </section>

            <!-- Best Sellers -->
            <section id="best-sellers-section" class="max-w-7xl mx-auto px-4 mt-8 mb-8 animate-slide-up scroll-mt-48">
                <div class="flex items-center gap-2 mb-6 text-primary">
                    <i data-lucide="flame" class="animate-pulse w-6 h-6 fill-current"></i>
                    <h3 class="text-xl font-black uppercase tracking-wider text-foreground drop-shadow-sm">MAIS PEDIDOS</h3>
                </div>
                <div id="best-sellers-grid" class="flex overflow-x-auto gap-6 pb-6 pt-2 no-scrollbar snap-x -mx-4 px-4 md:mx-0 md:px-0"></div>
            </section>

            <!-- Full Menu Grid -->
            <div id="full-menu-container" class="max-w-7xl mx-auto px-4 pb-16 pt-4">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-2 text-muted-foreground">
                        <i data-lucide="chef-hat" class="w-5 h-5"></i>
                        <h3 id="menu-title" class="text-sm font-bold uppercase tracking-wider">CARDÁPIO COMPLETO</h3>
                    </div>
                </div>
                <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
                <div id="empty-state" class="hidden text-center py-20">
                    <div class="inline-flex p-4 rounded-full bg-secondary mb-4 text-muted-foreground"><i data-lucide="search-x" class="w-8 h-8"></i></div>
                    <p class="text-muted-foreground text-lg font-medium">Nenhum item encontrado.</p>
                </div>
            </div>

            <!-- Footer -->
            <footer class="mt-auto border-t border-border bg-background/60 backdrop-blur-xl transition-colors duration-300">
                <div class="max-w-7xl mx-auto px-4 py-8">
                    <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                        <div class="text-center md:text-left">
                            <div class="flex items-center justify-center md:justify-start gap-2 mb-1">
                                <i data-lucide="chef-hat" class="text-primary w-5 h-5"></i>
                                <span class="text-lg font-black text-foreground tracking-tighter">BLACK<span class="text-primary">BURGER</span></span>
                            </div>
                            <p class="text-muted-foreground text-xs">&copy; 2024 Black Burger. Feito com <i data-lucide="heart" class="inline w-3 h-3 text-primary fill-current animate-pulse"></i></p>
                        </div>
                        <div class="flex items-center gap-4">
                            <a href="#" class="w-10 h-10 rounded-full bg-secondary hover:bg-primary hover:text-primary-foreground flex items-center justify-center transition-all duration-300 transform hover:scale-110 hover:-translate-y-1 text-foreground"><i data-lucide="instagram" class="w-4 h-4"></i></a>
                            <a href="#" class="w-10 h-10 rounded-full bg-secondary hover:bg-blue-600 hover:text-white flex items-center justify-center transition-all duration-300 transform hover:scale-110 hover:-translate-y-1 text-foreground"><i data-lucide="facebook" class="w-4 h-4"></i></a>
                            <a href="#" class="w-10 h-10 rounded-full bg-secondary hover:bg-black hover:text-white flex items-center justify-center transition-all duration-300 transform hover:scale-110 hover:-translate-y-1 text-foreground"><i data-lucide="twitter" class="w-4 h-4"></i></a>
                        </div>
                        <button onclick="toggleLoginModal()" class="text-xs font-bold text-muted-foreground hover:text-primary transition-colors uppercase tracking-widest flex items-center gap-2 group"><i data-lucide="lock" class="w-3 h-3 group-hover:scale-110 transition-transform"></i> Admin</button>
                    </div>
                </div>
            </footer>
        </main>

        <!-- Product Details View (Detached) -->
        <div id="details-view" class="hidden flex-1 animate-fade-in relative z-20">
            <div class="max-w-7xl mx-auto px-4 py-8">
                <button onclick="closeDetails()" class="group flex items-center gap-2 text-muted-foreground hover:text-foreground mb-8 transition-colors font-medium text-sm">
                    <div class="p-2 rounded-full bg-secondary group-hover:bg-muted transition-all group-hover:-translate-x-1">
                        <i data-lucide="arrow-left" class="w-4 h-4"></i>
                    </div>
                    VOLTAR AO MENU
                </button>
                <div id="details-content" class="grid grid-cols-1 lg:grid-cols-12 gap-12 items-start"></div>
            </div>
        </div>

        <!-- Order Details Modal (ADDED BACK) -->
        <div id="order-details-modal" class="fixed inset-0 z-[70] flex items-center justify-center bg-black/80 backdrop-blur-sm hidden animate-fade-in p-4">
            <div class="bg-card w-full max-w-lg rounded-3xl shadow-2xl border border-border flex flex-col max-h-[90vh]">
                <div class="p-6 border-b border-border flex justify-between items-center bg-muted/30">
                    <div>
                        <span class="text-xs font-bold text-muted-foreground uppercase tracking-wider">Detalhes</span>
                        <h3 class="text-xl font-black text-foreground mt-0.5" id="modal-order-id">Pedido #0000</h3>
                        <p class="text-sm text-muted-foreground mt-1" id="modal-order-date">Data</p>
                    </div>
                    <button onclick="toggleOrderDetails()" class="w-10 h-10 rounded-full bg-background hover:bg-accent flex items-center justify-center transition-colors shadow-sm border border-border">
                        <i data-lucide="x" class="w-5 h-5 text-muted-foreground"></i>
                    </button>
                </div>
                
                <div class="p-6 overflow-y-auto flex-1">
                    <h4 class="text-xs font-bold text-muted-foreground uppercase tracking-widest mb-4">Itens do Pedido</h4>
                    <div id="modal-order-items" class="space-y-3"></div>
                    <div class="mt-8 pt-6 border-t border-border flex justify-between items-end">
                        <span class="text-sm font-medium text-muted-foreground">Valor Total</span>
                        <span class="text-3xl font-black text-foreground" id="modal-order-total">R$ 0,00</span>
                    </div>
                </div>
                
                <div class="p-6 bg-muted/30 border-t border-border rounded-b-3xl">
                    <p class="text-xs font-bold text-muted-foreground uppercase tracking-wider mb-3 text-center">Atualizar Status</p>
                    <div class="grid grid-cols-3 gap-3">
                        <button onclick="updateOrderStatusFromModal('Em Preparo')" class="flex flex-col items-center justify-center gap-2 bg-card hover:bg-blue-500/10 border border-border hover:border-blue-500/30 p-3 rounded-xl transition-all group">
                            <div class="w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-500/20 text-blue-600 dark:text-blue-400 flex items-center justify-center group-hover:scale-110 transition-transform">
                                <i data-lucide="chef-hat" class="w-4 h-4"></i>
                            </div>
                            <span class="text-xs font-bold text-blue-700 dark:text-blue-300">Preparar</span>
                        </button>
                        <button onclick="updateOrderStatusFromModal('Entregue')" class="flex flex-col items-center justify-center gap-2 bg-card hover:bg-green-500/10 border border-border hover:border-green-500/30 p-3 rounded-xl transition-all group">
                            <div class="w-8 h-8 rounded-full bg-green-100 dark:bg-green-500/20 text-green-600 dark:text-green-400 flex items-center justify-center group-hover:scale-110 transition-transform">
                                <i data-lucide="check" class="w-4 h-4"></i>
                            </div>
                            <span class="text-xs font-bold text-green-700 dark:text-green-300">Entregar</span>
                        </button>
                        <button onclick="updateOrderStatusFromModal('Cancelado')" class="flex flex-col items-center justify-center gap-2 bg-card hover:bg-destructive/10 border border-border hover:border-destructive/30 p-3 rounded-xl transition-all group">
                            <div class="w-8 h-8 rounded-full bg-red-100 dark:bg-red-500/20 text-destructive flex items-center justify-center group-hover:scale-110 transition-transform">
                                <i data-lucide="x" class="w-4 h-4"></i>
                            </div>
                            <span class="text-xs font-bold text-destructive">Cancelar</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upsell Modal -->
        <div id="upsell-modal" class="fixed inset-0 z-[70] flex items-center justify-center bg-background/80 backdrop-blur-sm hidden animate-fade-in p-4">
             <div class="bg-card border border-border w-full max-w-sm rounded-3xl shadow-2xl relative overflow-hidden transform scale-95 opacity-0 transition-all duration-300" id="upsell-modal-content">
                <div class="relative h-40 bg-accent flex items-center justify-center overflow-hidden">
                    <img src="https://images.unsplash.com/photo-1621532822165-27a3c3167198?auto=format&fit=crop&q=80&w=400" class="absolute inset-0 w-full h-full object-cover opacity-80 hover:scale-110 transition-transform duration-700" alt="Combo">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                    <div class="relative z-10 text-center p-4">
                        <span class="bg-primary text-primary-foreground text-xs font-bold px-2 py-1 rounded-full uppercase tracking-wider mb-2 inline-block animate-pulse">Oferta Especial</span>
                        <h3 class="text-2xl font-black text-white leading-none drop-shadow-md">Turbine seu pedido!</h3>
                    </div>
                </div>
                <div class="p-6 text-center">
                    <p class="text-muted-foreground font-medium mb-6">Que tal adicionar um acompanhamento por um preço especial?</p>
                    <div class="flex flex-col gap-3">
                        <button onclick="acceptUpsell('fries')" class="w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3.5 rounded-xl shadow-lg transition-all flex items-center justify-between px-4 group hover:-translate-y-1">
                            <span class="flex items-center gap-2"><i data-lucide="utensils" class="w-4 h-4"></i> Batata Frita</span>
                            <span class="bg-black/10 px-2 py-1 rounded-lg text-xs font-black">+ R$ 5,00</span>
                        </button>
                        <button onclick="acceptUpsell('drink')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3.5 rounded-xl shadow-lg transition-all flex items-center justify-between px-4 group hover:-translate-y-1">
                            <span class="flex items-center gap-2"><i data-lucide="cup-soda" class="w-4 h-4"></i> Bebida Gelada</span>
                            <span class="bg-white/20 px-2 py-1 rounded-lg text-xs font-black">+ R$ 6,00</span>
                        </button>
                        <button onclick="acceptUpsell('combo')" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-green-600/20 transition-all flex items-center justify-between px-4 transform active:scale-95 group hover:-translate-y-1">
                            <span class="flex items-center gap-2"><i data-lucide="check-circle" class="w-5 h-5"></i> COMBO COMPLETO</span>
                            <span class="bg-white/20 px-2 py-1 rounded-lg text-xs font-black">+ R$ 10,00</span>
                        </button>
                        <button onclick="declineUpsell()" class="w-full bg-transparent hover:bg-muted text-muted-foreground font-bold py-2 rounded-xl transition-all text-xs mt-2 hover:text-black dark:hover:text-white">
                            Não, obrigado
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payment Modal -->
        <div id="payment-modal" class="fixed inset-0 z-[80] flex items-center justify-center bg-background/80 backdrop-blur-sm hidden animate-fade-in p-4">
             <div class="bg-card w-full max-w-sm rounded-3xl shadow-2xl border border-border relative transform scale-95 opacity-0 transition-all duration-300" id="payment-modal-content">
                <div class="p-6 border-b border-border flex justify-between items-center">
                    <h3 class="text-lg font-black text-foreground">Forma de Pagamento</h3>
                    <button onclick="closePaymentModal()" class="text-muted-foreground hover:text-foreground hover:rotate-90 transition-transform"><i data-lucide="x" class="w-5 h-5"></i></button>
                </div>
                <div class="p-6 space-y-3">
                    <button onclick="finalizeOrder('Cartão de Crédito')" class="w-full flex items-center justify-between p-4 rounded-xl border border-border hover:border-primary hover:bg-primary/10 transition-all group hover:-translate-y-1 shadow-sm hover:shadow-md"><div class="flex items-center gap-3"><i data-lucide="credit-card" class="text-muted-foreground group-hover:text-primary transition-colors"></i><span class="font-bold text-foreground group-hover:text-primary transition-colors">Cartão de Crédito</span></div><i data-lucide="chevron-right" class="w-4 h-4 text-muted-foreground group-hover:translate-x-1 transition-transform"></i></button>
                    <button onclick="finalizeOrder('Cartão de Débito')" class="w-full flex items-center justify-between p-4 rounded-xl border border-border hover:border-primary hover:bg-primary/10 transition-all group hover:-translate-y-1 shadow-sm hover:shadow-md"><div class="flex items-center gap-3"><i data-lucide="credit-card" class="text-muted-foreground group-hover:text-primary transition-colors"></i><span class="font-bold text-foreground group-hover:text-primary transition-colors">Cartão de Débito</span></div><i data-lucide="chevron-right" class="w-4 h-4 text-muted-foreground group-hover:translate-x-1 transition-transform"></i></button>
                    <button onclick="finalizeOrder('PIX')" class="w-full flex items-center justify-between p-4 rounded-xl border border-border hover:border-green-500 hover:bg-green-500/10 transition-all group hover:-translate-y-1 shadow-sm hover:shadow-md"><div class="flex items-center gap-3"><i data-lucide="zap" class="text-muted-foreground group-hover:text-green-600 transition-colors"></i><span class="font-bold text-foreground group-hover:text-green-600 transition-colors">PIX</span></div><i data-lucide="chevron-right" class="w-4 h-4 text-muted-foreground group-hover:translate-x-1 transition-transform"></i></button>
                    <button onclick="finalizeOrder('Dinheiro')" class="w-full flex items-center justify-between p-4 rounded-xl border border-border hover:border-blue-500 hover:bg-blue-500/10 transition-all group hover:-translate-y-1 shadow-sm hover:shadow-md"><div class="flex items-center gap-3"><i data-lucide="banknote" class="text-muted-foreground group-hover:text-blue-600 transition-colors"></i><span class="font-bold text-foreground group-hover:text-blue-600 transition-colors">Dinheiro</span></div><i data-lucide="chevron-right" class="w-4 h-4 text-muted-foreground group-hover:translate-x-1 transition-transform"></i></button>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div id="login-modal" class="fixed inset-0 z-[60] flex items-center justify-center bg-background/80 backdrop-blur-sm hidden animate-fade-in p-4">
             <div class="bg-card w-full max-w-md p-8 rounded-3xl shadow-2xl border border-border relative">
                <button onclick="toggleLoginModal()" class="absolute top-4 right-4 text-muted-foreground hover:text-foreground transition-colors hover:rotate-90"><i data-lucide="x" class="w-6 h-6"></i></button>
                <div class="text-center mb-8">
                    <i data-lucide="shield-check" class="w-12 h-12 text-primary mx-auto mb-4 animate-bounce"></i>
                    <h2 class="text-2xl font-black text-foreground">ACESSO RESTRITO</h2>
                    <p class="text-muted-foreground text-sm">Área administrativa do Black Burger</p>
                </div>
                <form onsubmit="handleLogin(event)" class="space-y-4">
                    <div><label class="block text-xs font-bold text-muted-foreground uppercase tracking-wider mb-2">Usuário</label><input type="text" id="login-user" class="w-full bg-input border border-border p-4 rounded-xl text-foreground focus:border-primary outline-none transition-colors" placeholder="admin"></div>
                    <div><label class="block text-xs font-bold text-muted-foreground uppercase tracking-wider mb-2">Senha</label><input type="password" id="login-pass" class="w-full bg-input border border-border p-4 rounded-xl text-foreground focus:border-primary outline-none transition-colors" placeholder="••••"></div>
                    <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-primary-foreground font-bold py-4 rounded-xl shadow-lg shadow-primary/20 transition-all flex items-center justify-center gap-2 transform hover:scale-105 active:scale-95">ENTRAR <i data-lucide="arrow-right" class="w-5 h-5"></i></button>
                </form>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="admin-dashboard" class="fixed inset-0 z-50 bg-background/95 backdrop-blur-sm overflow-y-auto hidden">
            <!-- Header -->
            <div class="sticky top-0 z-50 bg-background/90 backdrop-blur-xl border-b border-border shadow-sm">
                <div class="max-w-7xl mx-auto px-4 h-20 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="bg-primary p-2 rounded-lg shadow-lg shadow-primary/20"><i data-lucide="layout-dashboard" class="text-primary-foreground w-5 h-5"></i></div>
                        <div><span class="text-xs font-bold text-primary uppercase tracking-wider">Modo Admin</span><h1 class="text-xl font-black text-foreground">Gerenciar</h1></div>
                    </div>
                    <button onclick="toggleAdminDashboard()" class="px-4 py-2 rounded-xl border border-border text-muted-foreground hover:bg-accent font-bold text-sm transition-colors flex items-center gap-2 hover:text-destructive"><i data-lucide="log-out" class="w-4 h-4"></i> SAIR</button>
                </div>
                <div class="max-w-7xl mx-auto px-4 border-t border-border">
                    <div class="flex gap-6 overflow-x-auto no-scrollbar">
                        <button onclick="switchAdminView('products')" id="tab-products" class="py-3 text-sm font-bold border-b-2 border-primary text-primary transition-colors whitespace-nowrap">CARDÁPIO</button>
                        <button onclick="switchAdminView('orders')" id="tab-orders" class="py-3 text-sm font-bold border-b-2 border-transparent text-muted-foreground hover:text-foreground transition-colors whitespace-nowrap">PEDIDOS</button>
                        <button onclick="switchAdminView('qr')" id="tab-qr" class="py-3 text-sm font-bold border-b-2 border-transparent text-muted-foreground hover:text-foreground transition-colors whitespace-nowrap">QR CODES</button>
                        <button onclick="switchAdminView('promos')" id="tab-promos" class="py-3 text-sm font-bold border-b-2 border-transparent text-muted-foreground hover:text-foreground transition-colors whitespace-nowrap flex items-center gap-2"><i data-lucide="zap" class="w-3 h-3"></i> PROMOÇÕES</button>
                        <!-- NEW: HORÁRIOS Tab -->
                        <button onclick="switchAdminView('hours')" id="tab-hours" class="py-3 text-sm font-bold border-b-2 border-transparent text-muted-foreground hover:text-foreground transition-colors whitespace-nowrap flex items-center gap-2"><i data-lucide="clock" class="w-3 h-3"></i> HORÁRIOS</button>
                        <!-- NEW: IA Insights Tab -->
                        <button onclick="switchAdminView('insights')" id="tab-insights" class="py-3 text-sm font-bold border-b-2 border-transparent text-muted-foreground hover:text-foreground transition-colors whitespace-nowrap flex items-center gap-2"><i data-lucide="brain-circuit" class="w-4 h-4 text-purple-500"></i> INSIGHTS IA</button>
                    </div>
                </div>
            </div>

            <div class="max-w-7xl mx-auto px-4 py-8 pb-32">
                <!-- VIEW PRODUCTS (Existing) -->
                <div id="admin-view-products">
                    <!-- ... Add Product Form ... -->
                    <div class="bg-card border border-border rounded-3xl p-6 md:p-8 shadow-xl mb-12">
                        <h3 class="text-lg font-bold text-foreground mb-6 flex items-center gap-2"><i data-lucide="plus-circle" class="text-primary w-5 h-5"></i><span id="form-title">Adicionar Novo Item</span></h3>
                        <form onsubmit="handleSaveProduct(event)" class="space-y-6">
                            <input type="hidden" id="edit-id">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="space-y-2"><label class="text-xs font-bold text-muted-foreground uppercase">Nome do Produto</label><input id="admin-name" class="w-full bg-input border border-border p-3 rounded-xl text-foreground focus:border-primary outline-none transition-colors" required /></div>
                                <div class="space-y-2"><label class="text-xs font-bold text-muted-foreground uppercase">Preço (R$)</label><input id="admin-price" type="number" step="0.10" class="w-full bg-input border border-border p-3 rounded-xl text-foreground focus:border-primary outline-none" required /></div>
                            </div>
                            <div class="space-y-2"><label class="text-xs font-bold text-muted-foreground uppercase">URL da Imagem</label><input id="admin-image" class="w-full bg-input border border-border p-3 rounded-xl text-foreground focus:border-primary outline-none" placeholder="https://..." /></div>
                            <div class="space-y-2"><label class="text-xs font-bold text-muted-foreground uppercase">Descrição</label><textarea id="admin-desc" class="w-full bg-input border border-border p-3 rounded-xl text-foreground focus:border-primary outline-none h-24 resize-none"></textarea></div>
                            <div class="flex flex-wrap gap-4 py-2">
                                <label class="flex items-center gap-2 cursor-pointer bg-secondary px-3 py-2 rounded-lg border border-border hover:border-primary transition-all"><input type="checkbox" id="admin-tag-spicy" class="w-4 h-4 accent-primary rounded cursor-pointer"><span class="text-sm font-bold text-foreground flex items-center gap-1"><i data-lucide="flame" class="w-3 h-3 text-orange-500"></i> Picante</span></label>
                                <label class="flex items-center gap-2 cursor-pointer bg-secondary px-3 py-2 rounded-lg border border-border hover:border-green-500 transition-all"><input type="checkbox" id="admin-tag-vegan" class="w-4 h-4 accent-green-600 rounded cursor-pointer"><span class="text-sm font-bold text-foreground flex items-center gap-1"><i data-lucide="leaf" class="w-3 h-3 text-green-500"></i> Vegano</span></label>
                                <label class="flex items-center gap-2 cursor-pointer bg-secondary px-3 py-2 rounded-lg border border-border hover:border-blue-500 transition-all"><input type="checkbox" id="admin-tag-gluten_free" class="w-4 h-4 accent-blue-500 rounded cursor-pointer"><span class="text-sm font-bold text-foreground flex items-center gap-1"><i data-lucide="wheat-off" class="w-3 h-3 text-blue-500"></i> Sem Glúten</span></label>
                                <label class="flex items-center gap-2 cursor-pointer bg-yellow-500/10 px-3 py-2 rounded-lg border border-yellow-500/30 hover:border-yellow-500 transition-all hover:-translate-y-0.5"><input type="checkbox" id="admin-promo" class="w-4 h-4 accent-yellow-500 rounded cursor-pointer"><span class="text-sm font-bold text-foreground flex items-center gap-1"><i data-lucide="sparkles" class="w-3 h-3 text-yellow-500"></i> Em Promoção</span></label>
                            </div>
                            <div class="flex flex-col md:flex-row gap-4 items-end">
                                <div class="flex-1 space-y-2 w-full relative"><div class="flex justify-between items-center"><label class="text-xs font-bold text-muted-foreground uppercase">Categoria</label><button type="button" onclick="addNewCategory()" class="text-xs text-primary font-bold hover:underline bg-primary/10 px-2 py-0.5 rounded hover:bg-primary/20 transition-colors">+ Nova</button></div><select id="admin-cat" class="w-full bg-input border border-border p-3 rounded-xl text-foreground focus:border-primary outline-none cursor-pointer"></select></div>
                                <button type="submit" id="save-btn" class="w-full md:w-auto bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-8 rounded-xl flex items-center justify-center gap-2 transition-all shadow-lg shadow-green-600/20"><i data-lucide="save" class="w-4 h-4"></i> SALVAR PRODUTO</button>
                                <button type="button" onclick="resetForm()" class="w-full md:w-auto bg-muted text-muted-foreground font-bold py-3 px-6 rounded-xl transition-all hover:bg-secondary border border-border">LIMPAR</button>
                            </div>
                        </form>
                    </div>
                    <!-- Products List -->
                    <div class="bg-card border border-border rounded-3xl overflow-hidden shadow-xl">
                         <div class="p-6 border-b border-border flex justify-between items-center"><h3 class="text-lg font-bold text-foreground">Itens Cadastrados</h3><span class="text-xs font-bold bg-secondary px-3 py-1 rounded-full text-muted-foreground" id="total-items-badge">0 itens</span></div>
                         <div class="overflow-x-auto"><table class="w-full text-left"><thead class="bg-muted text-xs uppercase text-muted-foreground"><tr><th class="p-4 pl-6">Produto</th><th class="p-4">Categoria</th><th class="p-4">Preço</th><th class="p-4 text-right pr-6">Ações</th></tr></thead><tbody id="admin-products-list" class="divide-y divide-border text-sm"></tbody></table></div>
                    </div>
                </div>

                <!-- VIEW: ORDERS (Existing) -->
                <div id="admin-view-orders" class="hidden animate-fade-in space-y-8">
                     <!-- ... Stats ... -->
                     <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="bg-card p-6 rounded-2xl shadow-lg border border-border flex items-center justify-between"><div><p class="text-sm font-medium text-muted-foreground mb-1">Receita Total</p><h4 class="text-2xl font-black text-foreground" id="dash-total-revenue">R$ 0,00</h4></div><div class="w-12 h-12 rounded-full bg-green-500/10 text-green-600 flex items-center justify-center"><i data-lucide="dollar-sign" class="w-6 h-6"></i></div></div>
                        <div class="bg-card p-6 rounded-2xl shadow-lg border border-border flex items-center justify-between"><div><p class="text-sm font-medium text-muted-foreground mb-1">Total Pedidos</p><h4 class="text-2xl font-black text-foreground" id="dash-total-count">0</h4></div><div class="w-12 h-12 rounded-full bg-blue-500/10 text-blue-600 flex items-center justify-center"><i data-lucide="shopping-bag" class="w-6 h-6"></i></div></div>
                        <div class="bg-card p-6 rounded-2xl shadow-lg border border-border flex items-center justify-between"><div><p class="text-sm font-medium text-muted-foreground mb-1">Ticket Médio</p><h4 class="text-2xl font-black text-foreground" id="dash-avg-ticket">R$ 0,00</h4></div><div class="w-12 h-12 rounded-full bg-yellow-500/10 text-yellow-600 flex items-center justify-center"><i data-lucide="trending-up" class="w-6 h-6"></i></div></div>
                        <div class="bg-card p-6 rounded-2xl shadow-lg border border-border flex items-center justify-between"><div><p class="text-sm font-medium text-muted-foreground mb-1">Entregues</p><h4 class="text-2xl font-black text-foreground" id="dash-conversion">0%</h4></div><div class="w-12 h-12 rounded-full bg-purple-500/10 text-purple-600 flex items-center justify-center"><i data-lucide="check-circle-2" class="w-6 h-6"></i></div></div>
                    </div>
                    <!-- Table -->
                    <div class="bg-card rounded-3xl border border-border shadow-xl overflow-hidden">
                         <div class="p-6 border-b border-border flex flex-col lg:flex-row gap-4 justify-between items-end lg:items-center bg-muted/30">
                             <div><h3 class="text-lg font-bold text-foreground">Últimos Pedidos</h3><p class="text-sm text-muted-foreground">Gerencie o status</p></div>
                             <div class="flex flex-wrap gap-3 w-full lg:w-auto">
                                 <div class="flex items-center bg-background border border-border rounded-xl px-3 py-2 shadow-sm"><i data-lucide="calendar" class="w-4 h-4 text-muted-foreground mr-2"></i><input type="date" id="order-filter-start" onchange="handleOrderFilter()" class="bg-transparent text-sm font-medium text-foreground focus:outline-none w-28 sm:w-auto"><span class="text-muted-foreground mx-2">-</span><input type="date" id="order-filter-end" onchange="handleOrderFilter()" class="bg-transparent text-sm font-medium text-foreground focus:outline-none w-28 sm:w-auto"></div>
                                 <div class="relative min-w-[140px]"><select id="order-filter-status" onchange="handleOrderFilter()" class="w-full appearance-none bg-background border border-border rounded-xl px-4 py-2.5 text-sm font-bold text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 shadow-sm cursor-pointer"><option value="all">Todos Status</option><option value="Pendente">Pendentes</option><option value="Em Preparo">Em Preparo</option><option value="Entregue">Entregues</option><option value="Cancelado">Cancelados</option></select></div>
                             </div>
                         </div>
                         <div class="overflow-x-auto"><table class="w-full text-left border-collapse"><thead class="bg-muted/50 border-b border-border text-xs font-bold text-muted-foreground uppercase tracking-wider"><tr><th class="p-5 pl-6">ID Pedido</th><th class="p-5">Data & Hora</th><th class="p-5 w-1/3">Resumo (Itens)</th><th class="p-5">Valor</th><th class="p-5">Status</th><th class="p-5 text-right pr-6">Ação</th></tr></thead><tbody id="admin-orders-list" class="divide-y divide-border text-sm font-medium"></tbody></table></div>
                         <div id="no-orders-msg" class="hidden flex flex-col items-center justify-center p-16 text-muted-foreground"><p class="text-base font-medium">Nenhum pedido encontrado.</p></div>
                    </div>
                </div>

                <!-- VIEW: QR (Existing) -->
                <div id="admin-view-qr" class="hidden animate-fade-in">
                    <div class="bg-card border border-border rounded-3xl p-8 shadow-xl max-w-2xl mx-auto text-center">
                        <div class="mb-8"><div class="inline-flex p-4 rounded-full bg-secondary mb-4 text-foreground"><i data-lucide="qr-code" class="w-8 h-8"></i></div><h3 class="text-2xl font-black text-foreground mb-2">Gerador de QR Code de Mesa</h3></div>
                        <div class="space-y-6">
                            <div class="flex flex-col items-start text-left max-w-sm mx-auto"><label class="text-xs font-bold text-muted-foreground uppercase tracking-wider mb-2">Número da Mesa</label><div class="flex w-full gap-2"><input type="number" id="qr-table-num" class="flex-1 bg-input border border-border p-4 rounded-xl text-foreground focus:border-primary outline-none transition-colors text-center text-lg font-bold" placeholder="10"><button onclick="generateQRCode()" class="bg-primary hover:bg-primary/90 text-primary-foreground font-bold px-6 rounded-xl transition-colors">GERAR</button></div></div>
                            <div id="qr-result-area" class="hidden flex flex-col items-center animate-fade-in pt-8 border-t border-border mt-8"><div class="bg-white p-4 rounded-2xl shadow-lg mb-4"><div id="qrcode-container"></div></div><p class="font-bold text-lg text-foreground mb-4">Mesa <span id="qr-display-num"></span></p><button onclick="printQRCode()" class="text-sm font-bold text-muted-foreground hover:text-foreground flex items-center gap-2 transition-colors"><i data-lucide="printer" class="w-4 h-4"></i> Imprimir</button></div>
                        </div>
                    </div>
                </div>

                <!-- VIEW: PROMOÇÕES (NEW) -->
                <div id="admin-view-promos" class="hidden animate-fade-in">
                    <div class="bg-card border border-border rounded-3xl overflow-hidden shadow-xl">
                        <div class="p-6 border-b border-border bg-gradient-to-r from-yellow-500/10 to-transparent flex justify-between items-center">
                            <div><h3 class="text-lg font-bold text-foreground flex items-center gap-2"><i data-lucide="zap" class="w-5 h-5 text-yellow-500"></i> Gestão de Ofertas Relâmpago</h3><p class="text-sm text-muted-foreground mt-1">Ative promoções e defina preços especiais.</p></div>
                        </div>
                        <div class="overflow-x-auto"><table class="w-full text-left"><thead class="bg-muted text-xs uppercase text-muted-foreground"><tr><th class="p-5 pl-6">Produto</th><th class="p-5">Preço Original</th><th class="p-5">Preço Promocional</th><th class="p-5">Status</th><th class="p-5 text-right pr-6">Ação</th></tr></thead><tbody id="admin-promos-list" class="divide-y divide-border text-sm"></tbody></table></div>
                    </div>
                </div>

                <!-- VIEW: HORÁRIOS (NEW) -->
                <div id="admin-view-hours" class="hidden animate-fade-in">
                    <div class="bg-card border border-border rounded-3xl shadow-xl overflow-hidden">
                        <div class="p-6 border-b border-border bg-muted/30 flex justify-between items-center">
                            <div>
                                <h3 class="text-lg font-bold text-foreground flex items-center gap-2">
                                    <i data-lucide="clock" class="w-5 h-5 text-primary"></i> Horários de Funcionamento
                                </h3>
                                <p class="text-sm text-muted-foreground mt-1">Configure os horários de abertura e fechamento para cada dia da semana.</p>
                            </div>
                            <button onclick="saveHours()" class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-6 rounded-xl flex items-center gap-2 transition-colors shadow-lg">
                                <i data-lucide="save" class="w-4 h-4"></i> Salvar Alterações
                            </button>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="hours-config-container">
                                <!-- Days injected by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- NEW VIEW: IA INSIGHTS -->
                <div id="admin-view-insights" class="hidden animate-fade-in space-y-6">
                     <div class="bg-gradient-to-br from-purple-900 to-indigo-900 rounded-3xl p-8 shadow-2xl border border-white/10 text-white relative overflow-hidden">
                         <div class="absolute top-0 right-0 w-64 h-64 bg-purple-500/20 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
                         <div class="relative z-10">
                             <div class="flex items-center gap-3 mb-4">
                                 <div class="p-3 bg-white/10 rounded-2xl backdrop-blur-md"><i data-lucide="brain-circuit" class="w-8 h-8 text-purple-300"></i></div>
                                 <div><h2 class="text-3xl font-black">Inteligência Artificial</h2><p class="text-purple-200">Análise de dados avançada para seu negócio</p></div>
                             </div>
                             <p class="mb-8 max-w-2xl text-purple-100/80 leading-relaxed">Nossa IA analisa seu histórico de vendas, produtos e comportamento dos clientes para gerar estratégias de crescimento personalizadas.</p>
                             <button onclick="fetchAIInsights()" id="btn-generate-insights" class="bg-white text-purple-900 hover:bg-purple-50 font-bold py-4 px-8 rounded-xl shadow-lg shadow-black/20 flex items-center gap-3 transition-all hover:scale-105 active:scale-95 group">
                                 <i data-lucide="sparkles" class="w-5 h-5 group-hover:text-yellow-500 transition-colors"></i> GERAR INSIGHTS AGORA
                             </button>
                         </div>
                     </div>

                     <div id="insights-loading" class="hidden text-center py-20">
                         <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mb-4"></div>
                         <p class="text-muted-foreground font-medium animate-pulse">A IA está analisando seus dados...</p>
                     </div>

                     <div id="insights-result" class="hidden grid grid-cols-1 md:grid-cols-3 gap-6">
                         <!-- Injected by JS -->
                     </div>
                </div>

            </div>
        </div>

        <!-- ... Modals ... -->
        <!-- Delete Confirmation Modal -->
        <div id="delete-confirmation-modal" class="fixed inset-0 z-[80] flex items-center justify-center bg-background/80 backdrop-blur-sm hidden animate-fade-in px-4">
            <div class="bg-card w-full max-w-sm p-6 rounded-3xl shadow-2xl border border-border text-center transform transition-all scale-100">
                <div class="w-16 h-16 bg-destructive/10 rounded-full flex items-center justify-center mx-auto mb-4 text-destructive animate-pulse"><i data-lucide="alert-triangle" class="w-8 h-8"></i></div>
                <h3 class="text-xl font-black text-foreground mb-2">Excluir Produto?</h3>
                <p class="text-muted-foreground text-sm mb-6 leading-relaxed">Esta ação não pode ser desfeita. O item será removido permanentemente do cardápio.</p>
                <div class="flex gap-3">
                    <button onclick="closeDeleteModal()" class="flex-1 bg-secondary hover:bg-muted text-foreground font-bold py-3 rounded-xl transition-colors border border-border">
                        CANCELAR
                    </button>
                    <button onclick="confirmDeleteProduct()" class="flex-1 bg-destructive hover:bg-destructive/90 text-destructive-foreground font-bold py-3 rounded-xl transition-colors shadow-lg shadow-destructive/20 flex items-center justify-center gap-2">
                        <i data-lucide="trash-2" class="w-4 h-4"></i> EXCLUIR
                    </button>
                </div>
            </div>
        </div>

        <!-- Cart Drawer -->
        <div id="cart-drawer" class="fixed inset-0 z-50 pointer-events-none transition-all duration-500">
            <div id="cart-overlay" class="absolute inset-0 bg-background/60 backdrop-blur-sm opacity-0 transition-opacity duration-500" onclick="toggleCart()"></div>
            <div id="cart-panel" class="absolute top-0 right-0 w-full md:w-[500px] h-full bg-card shadow-2xl border-l border-border transform translate-x-full transition-transform duration-500 flex flex-col pointer-events-auto">
                <div class="p-8 pb-4 flex justify-between items-center border-b border-border">
                    <div>
                        <h2 class="text-3xl font-black text-foreground tracking-tighter">MEU PEDIDO</h2>
                        <p class="text-muted-foreground text-sm mt-1">Delivery Black Burger</p>
                    </div>
                    <button onclick="toggleCart()" class="w-10 h-10 rounded-full bg-secondary hover:bg-accent text-foreground flex items-center justify-center transition-all">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                <div id="cart-items" class="flex-1 overflow-y-auto p-8 space-y-6"></div>
                <div class="p-8 bg-muted/10 border-t border-border">
                    <div id="cart-table-info" class="hidden mb-4 p-3 bg-green-500/10 text-green-700 dark:text-green-400 rounded-xl flex items-center justify-center gap-2 font-bold text-sm border border-green-500/20"><i data-lucide="map-pin" class="w-4 h-4"></i><span>Pedido para Mesa <span id="cart-table-num"></span></span></div>
                    <div class="flex justify-between items-end mb-6">
                        <span class="text-muted-foreground font-medium">Subtotal</span>
                        <span class="text-3xl font-black text-foreground">
                            <span class="text-lg text-primary mr-1">R$</span>
                            <span id="cart-total">0.00</span>
                        </span>
                    </div>
                    <button id="checkout-btn" onclick="checkoutWhatsApp()" class="w-full py-5 rounded-2xl font-black text-lg flex items-center justify-center gap-3 transition-all transform active:scale-95 bg-secondary text-muted-foreground cursor-not-allowed" disabled>
                        ENVIAR PEDIDO <i data-lucide="smartphone" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        const initialMenu = [
             { id: 1, active: true, name: "Monster Bacon", description: "Hambúrguer artesanal 180g, muito bacon crocante...", price: 32.90, category: "Sanduíches", image: "https://images.unsplash.com/photo-1594212699903-ec8a3eca50f5?auto=format&fit=crop&q=80&w=800", rating: 4.9, promo: false, promoPrice: 0, options: [{id: 'no_onion', name: 'Sem Cebola', price: 0}, {id: 'extra_bacon', name: 'Bacon Extra', price: 5.00}] },
             { id: 2, active: true, name: "Classic Salad", description: "Hambúrguer 150g, alface americana crocante...", price: 24.50, category: "Sanduíches", image: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?auto=format&fit=crop&q=80&w=800", rating: 4.5, promo: true, promoPrice: 19.90, options: [] },
             { id: 3, active: true, name: "Dark Chicken", description: "Filé de frango empanado no panko escuro...", price: 28.00, category: "Sanduíches", image: "https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?auto=format&fit=crop&q=80&w=800", rating: 4.7, promo: false, promoPrice: 0, tags: ['spicy'], options: [] },
             { id: 4, active: true, name: "Coca-Cola Zero", description: "Lata 350ml bem gelada.", price: 6.00, category: "Bebidas", image: "https://images.unsplash.com/photo-1622483767028-3f66f32aef97?auto=format&fit=crop&q=80&w=800", rating: 5.0, promo: false, promoPrice: 0, options: [] },
             { id: 5, active: true, name: "Fritas Rústicas", description: "Batatas cortadas a mão...", price: 18.00, category: "Acompanhamentos", image: "https://images.unsplash.com/photo-1630384060421-a4323ceca041?auto=format&fit=crop&q=80&w=800", rating: 4.8, promo: true, promoPrice: 12.00, options: [] },
             { id: 6, active: true, name: "Smash Duplo", description: "Dois smash burgers...", price: 26.90, category: "Sanduíches", image: "https://images.unsplash.com/photo-1550547660-d9450f859349?auto=format&fit=crop&q=80&w=800", rating: 4.6, promo: false, promoPrice: 0, options: [] }
        ];

        const dietaryTags = [
            { id: 'spicy', label: 'Picante', icon: 'flame', color: 'text-orange-500', border: 'border-orange-500/30', bg: 'bg-orange-500/10' },
            { id: 'vegan', label: 'Vegano', icon: 'leaf', color: 'text-green-500', border: 'border-green-500/30', bg: 'bg-green-500/10' },
            { id: 'gluten_free', label: 'Sem Glúten', icon: 'wheat-off', color: 'text-blue-400', border: 'border-blue-400/30', bg: 'bg-blue-400/10' },
        ];
        
        const defaultHours = {
            "Segunda": { open: "18:00", close: "23:00", active: true },
            "Terça": { open: "18:00", close: "23:00", active: true },
            "Quarta": { open: "18:00", close: "23:00", active: true },
            "Quinta": { open: "18:00", close: "23:00", active: true },
            "Sexta": { open: "18:00", close: "00:00", active: true },
            "Sábado": { open: "18:00", close: "00:00", active: true },
            "Domingo": { open: "18:00", close: "23:00", active: true }
        };

        let state = {
            menu: [...initialMenu],
            cart: [],
            orders: [], 
            categories: ["Sanduíches", "Bebidas", "Acompanhamentos"], 
            openingHours: {...defaultHours},
            filter: "Todos",
            activeTag: null,
            searchTerm: "",
            isCartOpen: false,
            isAdminLoggedIn: false,
            adminView: 'products',
            selectedProduct: null,
            selectedOptions: {},
            selectedOrder: null,
            productToDeleteId: null,
            currentTable: null,
            pendingUpsellItem: null,
            pendingCheckout: null
        };

        document.addEventListener('DOMContentLoaded', () => {
            checkTableParam();
            loadData(); 
            lucide.createIcons();
            initTheme();
            renderCategories();
            renderFilters();
            renderBestSellers();
            renderMenu();
            renderCart();
            renderCategoryOptions(); 
            renderPromotions(); 
            renderOpeningHoursTag(); 
            
            if (state.orders.length === 0) {
                 const today = new Date();
                 const yesterday = new Date(today); yesterday.setDate(yesterday.getDate() - 1);
                 state.orders.push(
                     { id: 1025, date: today.toISOString(), total: 58.90, status: 'Pendente', items: [{ name: 'Monster Bacon', quantity: 1, price: 32.90, selectedOptions: [{name: 'Bacon Extra'}]}, { name: 'Classic Salad', quantity: 1, price: 24.50, selectedOptions: []}] },
                     { id: 1024, date: yesterday.toISOString(), total: 32.90, status: 'Entregue', items: [{ name: 'Monster Bacon', quantity: 1, price: 32.90, selectedOptions: []}] }
                 );
            }
        });
        
        // --- Functions ---
        // NEW: Function to open product details
        function openDetails(id) {
            const product = state.menu.find(p => p.id === id);
            if (!product) return;
            state.selectedProduct = product;
            state.selectedOptions = {};
            
            const mainView = document.getElementById('main-view');
            const detailsView = document.getElementById('details-view');
            const detailsContent = document.getElementById('details-content');

            mainView.classList.add('hidden');
            detailsView.classList.remove('hidden');
            window.scrollTo(0, 0);

            // Render details content
            const isPromo = product.promo && product.promoPrice > 0;
            const price = isPromo ? product.promoPrice : product.price;

            detailsContent.innerHTML = `
                <div class="col-span-1 lg:col-span-7 animate-slide-up">
                    <div class="rounded-3xl overflow-hidden shadow-2xl mb-8 relative aspect-square md:aspect-video group">
                        <img src="${product.image}" class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div>
                        <div class="absolute bottom-0 left-0 p-8 w-full">
                             <h2 class="text-3xl md:text-5xl font-black text-white mb-2 leading-none drop-shadow-lg">${product.name}</h2>
                             <div class="flex items-center gap-4">
                                <span class="text-3xl font-black text-primary drop-shadow-md">R$ ${price.toFixed(2)}</span>
                                ${isPromo ? `<span class="bg-red-600 text-white text-xs font-bold px-3 py-1 rounded-full animate-pulse shadow-lg">PROMOÇÃO</span>` : ''}
                             </div>
                        </div>
                    </div>
                    
                    <div class="prose dark:prose-invert max-w-none mb-8">
                        <h4 class="text-sm font-bold uppercase text-muted-foreground tracking-widest mb-3 flex items-center gap-2"><i data-lucide="info" class="w-4 h-4"></i> Descrição</h4>
                        <p class="text-lg leading-relaxed text-foreground bg-card p-6 rounded-2xl border border-border shadow-sm">${product.description}</p>
                    </div>
                </div>

                <div class="col-span-1 lg:col-span-5 animate-slide-up" style="animation-delay: 0.1s;">
                    <div class="bg-card border border-border rounded-[2rem] p-6 lg:p-8 shadow-xl sticky top-24">
                        ${product.options && product.options.length > 0 ? `
                            <div class="mb-8">
                                <h4 class="text-sm font-bold uppercase tracking-widest mb-4 flex items-center gap-2 text-foreground"><i data-lucide="layers" class="w-4 h-4"></i> Personalize seu pedido</h4>
                                <div class="space-y-3">
                                    ${product.options.map(o => `
                                        <label class="flex justify-between items-center p-4 bg-background rounded-xl cursor-pointer hover:border-primary border-2 border-transparent transition-all shadow-sm group hover:bg-accent/50 relative overflow-hidden">
                                            <div class="flex items-center gap-3 relative z-10">
                                                <div class="relative flex items-center">
                                                    <input type="checkbox" onchange="toggleOption('${o.id}')" class="peer w-6 h-6 appearance-none border-2 border-muted-foreground rounded-lg checked:bg-primary checked:border-primary transition-all">
                                                    <i data-lucide="check" class="w-4 h-4 text-white absolute top-1 left-1 opacity-0 peer-checked:opacity-100 pointer-events-none transition-opacity"></i>
                                                </div>
                                                <span class="font-bold text-sm text-foreground group-hover:text-primary transition-colors">${o.name}</span>
                                            </div>
                                            <span class="text-xs font-black bg-secondary px-3 py-1.5 rounded-lg text-foreground group-hover:bg-primary/10 group-hover:text-primary transition-colors">+ R$ ${o.price.toFixed(2)}</span>
                                        </label>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}

                        <div class="space-y-4">
                            <button onclick="addToCart()" class="w-full py-5 bg-primary hover:bg-primary/90 text-white font-black rounded-2xl shadow-xl shadow-primary/30 flex justify-between px-8 items-center text-lg transform transition-all hover:-translate-y-1 active:scale-95 group">
                                <span class="group-hover:translate-x-1 transition-transform">ADICIONAR À SACOLA</span>
                                <div class="flex items-center gap-2 text-sm bg-white/20 px-3 py-1 rounded-lg backdrop-blur-sm group-hover:bg-white/30 transition-colors">
                                    <i data-lucide="shopping-bag" class="w-4 h-4"></i>
                                    <span>R$ ${price.toFixed(2)}</span>
                                </div>
                            </button>
                            <button onclick="closeDetails()" class="w-full py-3 text-muted-foreground font-bold hover:text-foreground transition-colors text-sm">Cancelar e Voltar</button>
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        // NEW: Function to close details
        function closeDetails() {
            document.getElementById('details-view').classList.add('hidden');
            document.getElementById('main-view').classList.remove('hidden');
            state.selectedProduct = null;
            window.scrollTo(0, 0);
        }

        // NEW: Function to toggle options
        function toggleOption(optId) {
            state.selectedOptions[optId] = !state.selectedOptions[optId];
        }

        // NEW: Helper to calculate price
        function getCustomizedPrice(product, options) {
            let price = product.promo ? (product.promoPrice || product.price) : product.price;
            if(product.options) {
                product.options.forEach(opt => {
                    if(options[opt.id]) {
                        price += opt.price;
                    }
                });
            }
            return price;
        }

        function renderOpeningHoursTag() {
            const days = ["Domingo", "Segunda", "Terça", "Quarta", "Quinta", "Sexta", "Sábado"];
            const now = new Date();
            const todayStr = days[now.getDay()];
            const config = state.openingHours[todayStr];
            
            const badge = document.getElementById('hours-badge');
            if(!badge) return;

            if (config && config.active) {
                badge.innerHTML = `<span class="inline-flex items-center gap-1.5 px-2 py-0.5 rounded-md bg-green-100 dark:bg-green-900/30 border border-green-200 dark:border-green-800"><span class="relative flex h-2 w-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span></span><span class="text-[10px] font-bold text-green-700 dark:text-green-400 uppercase tracking-wide">Hoje: ${config.open} às ${config.close}</span></span>`;
            } else {
                 badge.innerHTML = `<span class="inline-flex items-center gap-1.5 px-2 py-0.5 rounded-md bg-red-100 dark:bg-red-900/30 border border-red-200 dark:border-red-800"><span class="h-2 w-2 rounded-full bg-red-500"></span><span class="text-[10px] font-bold text-red-700 dark:text-red-400 uppercase tracking-wide">Fechado Hoje</span></span>`;
            }
        }
        
        function shareMenu() {
            if (navigator.share) {
                navigator.share({
                    title: 'Black Burger',
                    text: 'Confira nosso cardápio digital!',
                    url: 'https://cardapioweb10.vercel.app/'
                })
                .catch((error) => console.log('Error sharing', error));
            } else {
                navigator.clipboard.writeText('https://cardapioweb10.vercel.app/');
                alert('Link copiado para a área de transferência!');
            }
        }

        function renderPromotions() {
            const container = document.getElementById('special-promos-grid');
            const section = document.getElementById('special-promos-section');
            const promos = state.menu.filter(p => p.promo === true && p.active !== false).slice(0, 3);
            if (promos.length === 0) { section.classList.add('hidden'); return; }
            section.classList.remove('hidden');
            container.innerHTML = promos.map((item, index) => `
                <div onclick="openDetails(${item.id})" class="flex-shrink-0 w-72 bg-card rounded-2xl p-4 border border-primary/30 cursor-pointer hover:scale-[1.02] transition-transform relative group shadow-md hover:shadow-lg">
                    <div class="absolute -top-3 -right-3 bg-red-600 text-white font-black text-xs px-3 py-1 rounded-full shadow-lg animate-bounce z-10">OFERTA</div>
                    <div class="h-40 rounded-xl overflow-hidden mb-4 relative">
                        <img src="${item.image}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" alt="${item.name}">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                        <div class="absolute bottom-2 left-2 right-2 text-white"><p class="font-bold text-lg leading-tight drop-shadow-md">${item.name}</p></div>
                    </div>
                    <div class="flex justify-between items-center">
                        <div class="flex flex-col"><span class="text-xs text-muted-foreground line-through">R$ ${item.price.toFixed(2)}</span><span class="text-xl font-black text-red-600 dark:text-red-500">R$ ${(item.promoPrice || item.price).toFixed(2)}</span></div>
                        <button class="bg-primary hover:bg-primary/90 text-primary-foreground p-2 rounded-full shadow-lg transition-colors"><i data-lucide="plus" class="w-5 h-5"></i></button>
                    </div>
                </div>`).join('');
            lucide.createIcons();
        }

        function checkTableParam() {
            const urlParams = new URLSearchParams(window.location.search);
            const table = urlParams.get('mesa');
            if (table) {
                state.currentTable = table;
                document.getElementById('table-number-display').innerText = table;
                document.getElementById('table-badge').classList.remove('hidden');
                document.getElementById('main-header').classList.remove('top-0');
                document.getElementById('main-header').classList.add('top-6');
                document.getElementById('controls-section').classList.remove('top-20');
                document.getElementById('controls-section').classList.add('top-26');
                const cartTableInfo = document.getElementById('cart-table-info');
                const cartTableNum = document.getElementById('cart-table-num');
                if(cartTableInfo && cartTableNum) { cartTableNum.innerText = table; cartTableInfo.classList.remove('hidden'); }
            }
        }
        function loadData() {
            const savedMenu = localStorage.getItem('blackBurgerMenu');
            const savedCategories = localStorage.getItem('blackBurgerCategories');
            const savedHours = localStorage.getItem('blackBurgerHours');
            if (savedMenu) state.menu = JSON.parse(savedMenu);
            else { state.menu = [...initialMenu]; saveData(); }
            if (savedCategories) state.categories = JSON.parse(savedCategories);
            if (savedHours) state.openingHours = JSON.parse(savedHours);
            const savedCart = localStorage.getItem('blackBurgerCart');
            if (savedCart) state.cart = JSON.parse(savedCart);
            const savedOrders = localStorage.getItem('blackBurgerOrders');
            if (savedOrders) state.orders = JSON.parse(savedOrders);
        }
        function saveData() {
            localStorage.setItem('blackBurgerMenu', JSON.stringify(state.menu));
            localStorage.setItem('blackBurgerCategories', JSON.stringify(state.categories));
            localStorage.setItem('blackBurgerCart', JSON.stringify(state.cart));
            localStorage.setItem('blackBurgerOrders', JSON.stringify(state.orders));
            localStorage.setItem('blackBurgerHours', JSON.stringify(state.openingHours));
        }

        function renderCategoryOptions() {
            const select = document.getElementById('admin-cat');
            if(!select) return;
            select.innerHTML = state.categories.map(c => `<option value="${c}">${c}</option>`).join('');
        }
        function addNewCategory() {
            const newCat = prompt("Nome da nova categoria:");
            if (newCat && newCat.trim() !== "") {
                const cat = newCat.trim();
                if (!state.categories.includes(cat)) {
                    state.categories.push(cat);
                    saveData();
                    renderCategoryOptions(); 
                    renderCategories(); 
                    setTimeout(() => { document.getElementById('admin-cat').value = cat; }, 100);
                    alert(`Categoria "${cat}" adicionada com sucesso!`);
                }
            }
        }
        function renderCategories() {
            const container = document.getElementById('categories-container');
            const allCats = ["Todos", ...state.categories];
            container.innerHTML = allCats.map(cat => `<button onclick="setFilter('${cat}')" class="px-6 py-2.5 rounded-full text-sm font-bold uppercase tracking-wider transition-all duration-300 whitespace-nowrap flex-shrink-0 ${state.filter === cat ? 'bg-primary text-primary-foreground shadow-lg shadow-primary/20' : 'bg-card border border-border text-muted-foreground hover:text-foreground hover:bg-accent backdrop-blur-sm'}">${cat}</button>`).join('');
        }
        
        function renderFilters() {
            const container = document.getElementById('filters-container');
            container.innerHTML = dietaryTags.map(tag => {
                const isActive = state.activeTag === tag.id;
                return `<button onclick="setTag('${tag.id}')" class="flex items-center gap-2 px-3 py-1.5 md:px-4 md:py-2 rounded-xl text-xs md:text-sm font-bold border transition-all duration-300 transform active:scale-95 flex-shrink-0 ${isActive ? `${tag.bg} ${tag.border} ${tag.color} shadow-lg ring-1 ring-offset-2 ring-offset-transparent backdrop-blur-md` : 'bg-card border-border text-muted-foreground hover:bg-accent backdrop-blur-sm'}"><i data-lucide="${tag.icon}" class="w-3.5 h-3.5"></i> ${tag.label} ${isActive ? '<i data-lucide="check" class="w-3.5 h-3.5 ml-1"></i>' : ''}</button>`
            }).join('');
            lucide.createIcons();
        }

        function setFilter(cat) { state.filter = cat; renderCategories(); renderBestSellers(); renderMenu(); }
        function setTag(tagId) { state.activeTag = state.activeTag === tagId ? null : tagId; renderFilters(); renderBestSellers(); renderMenu(); }
        function renderBestSellers() {
             const section = document.getElementById('best-sellers-section');
             if (state.filter !== "Todos" || state.activeTag !== null || state.searchTerm !== "") { section.classList.add('hidden'); return; }
             section.classList.remove('hidden');
             const container = document.getElementById('best-sellers-grid');
             const popular = [...state.menu].filter(item => item.active !== false).slice(0, 5);
             if (popular.length === 0) { container.innerHTML = `<p class="text-muted-foreground w-full text-center">Nenhum item em destaque.</p>`; return; }
             container.innerHTML = popular.map((item, index) => `
                <div onclick="openDetails(${item.id})" class="flex-shrink-0 w-28 md:w-32 snap-center flex flex-col items-center group cursor-pointer animate-fade-in">
                    <div class="relative mb-3">
                        <div class="absolute -top-1 -right-1 z-20 w-7 h-7 bg-accent text-accent-foreground font-black flex items-center justify-center rounded-full shadow-lg border-2 border-background text-xs">#${index + 1}</div>
                        <div class="w-24 h-24 md:w-28 md:h-28 rounded-full p-1 border-2 border-accent group-hover:border-primary transition-all duration-500 ease-out shadow-lg dark:shadow-none bg-card backdrop-blur-sm group-hover:scale-110 group-hover:rotate-3 group-hover:shadow-primary/40">
                            <div class="w-full h-full rounded-full overflow-hidden relative"><img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover" onerror="this.src='https://placehold.co/400x300/1a1a1a/red?text=Img'"></div>
                        </div>
                    </div>
                    <div class="text-center w-full px-1"><p class="font-bold text-xs md:text-sm leading-tight text-foreground line-clamp-2 h-8 group-hover:text-primary transition-colors drop-shadow-sm">${item.name}</p></div>
                </div>`).join('');
             lucide.createIcons();
        }
        function renderMenu() {
            const container = document.getElementById('products-grid');
            const title = document.getElementById('menu-title');
            const emptyState = document.getElementById('empty-state');
            let filtered = state.menu.filter(item => {
                const matchesCategory = state.filter === "Todos" || item.category === state.filter;
                const matchesTag = state.activeTag === null || (item.tags && item.tags.includes(state.activeTag));
                const term = state.searchTerm.toLowerCase();
                const matchesSearch = term === "" || item.name.toLowerCase().includes(term) || item.description.toLowerCase().includes(term);
                const isActive = item.active !== false;
                const isNotPromo = item.promo !== true; 
                return matchesCategory && matchesTag && matchesSearch && isActive && isNotPromo;
            });
            if (state.searchTerm) title.innerText = `RESULTADOS PARA: "${state.searchTerm}"`;
            else if (state.filter !== "Todos") title.innerText = `CATEGORIA: ${state.filter}`;
            else title.innerText = 'CARDÁPIO COMPLETO';
            if (filtered.length === 0) { container.innerHTML = ''; emptyState.classList.remove('hidden'); return; }
            emptyState.classList.add('hidden');
            container.innerHTML = filtered.map(item => {
                let tagsHtml = '';
                if (item.tags && item.tags.length > 0) {
                    tagsHtml = `<div class="flex gap-1 mt-1 justify-end">` + item.tags.map(tagId => { const t = dietaryTags.find(dt => dt.id === tagId); return t ? `<div class="w-6 h-6 rounded-full flex items-center justify-center ${t.bg} ${t.color} border ${t.border} backdrop-blur-md shadow-sm"><i data-lucide="${t.icon}" class="w-3 h-3"></i></div>` : ''; }).join('') + `</div>`;
                }
                const promoBadge = (item.promo && item.promoPrice > 0) ? `<div class="absolute top-3 left-3 z-20 bg-red-600 text-white text-xs font-black px-2 py-1 rounded shadow-lg animate-pulse">PROMO</div>` : '';
                const priceDisplay = (item.promo && item.promoPrice > 0) 
                    ? `<div class="flex flex-col"><span class="text-xs text-muted-foreground line-through">R$ ${Math.floor(item.price)}</span><span class="text-lg font-bold text-red-600 bg-red-100 dark:bg-red-900/30 px-2 py-0.5 rounded-lg">R$ ${Math.floor(item.promoPrice)}<span class="text-xs">,${(item.promoPrice % 1).toFixed(2).split('.')[1]}</span></span></div>`
                    : `<span class="text-lg font-bold text-primary bg-primary/10 px-2 py-1 rounded-lg whitespace-nowrap">R$ ${Math.floor(item.price)}<span class="text-xs align-top">,${(item.price % 1).toFixed(2).split('.')[1]}</span></span>`;

                return `<div onclick="openDetails(${item.id})" class="group relative bg-card backdrop-blur-md rounded-[2rem] p-4 cursor-pointer hover:bg-accent/5 transition-all duration-500 border border-border hover:border-primary/30 shadow-lg hover:shadow-2xl hover:shadow-primary/10 hover:-translate-y-2 animate-fade-in"><div class="aspect-[4/3] rounded-[1.5rem] overflow-hidden mb-4 relative bg-muted"><div class="absolute inset-0 bg-primary/0 group-hover:bg-primary/10 transition-colors z-10 duration-500"></div><img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover transform group-hover:scale-110 group-hover:rotate-1 transition-transform duration-700 ease-in-out" onerror="this.src='https://placehold.co/400x300/1a1a1a/red?text=Img'"><div class="absolute top-3 right-3 z-20 flex flex-col items-end gap-1"><div class="bg-background/80 backdrop-blur-md px-2 py-1 rounded-lg flex items-center gap-1 border border-border shadow-sm"><i data-lucide="star" class="w-3 h-3 text-yellow-500 fill-yellow-500"></i><span class="text-xs font-bold text-foreground">${item.rating}</span></div>${tagsHtml}</div>${promoBadge}</div><div class="px-2 pb-2"><div class="flex justify-between items-start mb-2"><h3 class="text-xl font-bold text-foreground tracking-tight group-hover:text-primary transition-colors duration-300">${item.name}</h3>${priceDisplay}</div><p class="text-muted-foreground text-sm leading-relaxed mb-6 line-clamp-2 h-10">${item.description}</p><button class="w-full h-12 rounded-xl bg-secondary hover:bg-primary hover:text-primary-foreground text-foreground font-bold flex items-center justify-between px-4 transition-all duration-300 group/btn border border-border hover:border-transparent active:scale-95"><span class="text-sm">VER DETALHES</span><div class="bg-background/50 group-hover/btn:bg-primary-foreground/20 p-1.5 rounded-lg transition-colors"><i data-lucide="plus" class="w-4 h-4"></i></div></button></div></div>`
            }).join('');
            lucide.createIcons();
        }
        function toggleCart() {
            const drawer = document.getElementById('cart-panel');
            const overlay = document.getElementById('cart-overlay');
            const cartDrawer = document.getElementById('cart-drawer');
            state.isCartOpen = !state.isCartOpen;
            if (state.isCartOpen) { cartDrawer.classList.remove('pointer-events-none'); drawer.classList.remove('translate-x-full'); overlay.classList.remove('opacity-0'); } else { cartDrawer.classList.add('pointer-events-none'); drawer.classList.add('translate-x-full'); overlay.classList.add('opacity-0'); }
        }
        function addToCart() {
            const product = state.selectedProduct;
            const options = state.selectedOptions;
            const activeOptionKeys = Object.keys(options).filter(k => options[k]);
            const uniqueId = `${product.id}-${activeOptionKeys.sort().join('-')}`;
            const price = getCustomizedPrice(product, options);
            const displayOptions = activeOptionKeys.map(key => product.options.find(o => o.id === key)).filter(Boolean);
            const itemToAdd = { ...product, uniqueId, quantity: 1, price, selectedOptions: displayOptions };
            if (product.category === 'Sanduíches') { state.pendingUpsellItem = itemToAdd; const modalContent = document.getElementById('upsell-modal-content'); document.getElementById('upsell-modal').classList.remove('hidden'); setTimeout(() => { modalContent.classList.remove('scale-95', 'opacity-0'); modalContent.classList.add('scale-100', 'opacity-100'); }, 10); } else { confirmAddToCart(itemToAdd); toggleCart(); }
        }
        function acceptUpsell(type) {
            confirmAddToCart(state.pendingUpsellItem);
            if (type === 'fries' || type === 'combo') { confirmAddToCart({ id: 9999, name: "Batata Frita Crocante (Promo)", price: 5.00, image: "https://images.unsplash.com/photo-1630384060421-a4323ceca041?auto=format&fit=crop&q=80&w=400", quantity: 1, uniqueId: `promo-fries-${Date.now()}`, selectedOptions: [] }); }
            if (type === 'drink' || type === 'combo') { confirmAddToCart({ id: 9998, name: "Coca-Cola Zero (Promo)", price: type === 'combo' ? 5.00 : 6.00, image: "https://images.unsplash.com/photo-1622483767028-3f66f32aef97?auto=format&fit=crop&q=80&w=800", quantity: 1, uniqueId: `promo-drink-${Date.now()}`, selectedOptions: [] }); }
            closeUpsellModal(); toggleCart();
        }
        function declineUpsell() { confirmAddToCart(state.pendingUpsellItem); closeUpsellModal(); toggleCart(); }
        function closeUpsellModal() { const modalContent = document.getElementById('upsell-modal-content'); modalContent.classList.remove('scale-100', 'opacity-100'); modalContent.classList.add('scale-95', 'opacity-0'); setTimeout(() => { document.getElementById('upsell-modal').classList.add('hidden'); state.pendingUpsellItem = null; }, 300); }
        function confirmAddToCart(item) { const existing = state.cart.find(i => i.uniqueId === item.uniqueId); if (existing) { existing.quantity += 1; } else { state.cart.push(item); } saveData(); renderCart(); }
        function removeFromCart(uniqueId) { state.cart = state.cart.filter(item => item.uniqueId !== uniqueId); saveData(); renderCart(); }
        function updateQuantity(uniqueId, delta) { state.cart = state.cart.map(item => { if (item.uniqueId === uniqueId) { const newQty = item.quantity + delta; return newQty > 0 ? { ...item, quantity: newQty } : item; } return item; }); saveData(); renderCart(); }
        
        function renderCart() {
             const container = document.getElementById('cart-items'); 
             const countBadge = document.getElementById('cart-count'); 
             const totalEl = document.getElementById('cart-total'); 
             const checkoutBtn = document.getElementById('checkout-btn');
             const total = state.cart.reduce((acc, item) => acc + (item.price * item.quantity), 0); 
             const count = state.cart.reduce((acc, item) => acc + item.quantity, 0);
             if (countBadge && count > 0) { countBadge.innerText = count; countBadge.classList.remove('hidden'); } else if (countBadge) countBadge.classList.add('hidden');
             if (totalEl) totalEl.innerText = total.toFixed(2);
             if (state.cart.length === 0) { 
                if(container) container.innerHTML = `<div class="h-full flex flex-col items-center justify-center text-muted-foreground gap-4 opacity-50"><div class="w-20 h-20 rounded-full bg-muted flex items-center justify-center"><i data-lucide="shopping-cart" class="w-8 h-8"></i></div><p class="font-medium">Sua sacola está vazia</p></div>`; 
                if(checkoutBtn) { checkoutBtn.disabled = true; checkoutBtn.classList.add('bg-secondary', 'text-muted-foreground', 'cursor-not-allowed'); checkoutBtn.classList.remove('bg-green-600', 'text-white'); }
             } else { 
                if(checkoutBtn) { checkoutBtn.disabled = false; checkoutBtn.classList.remove('bg-secondary', 'text-muted-foreground', 'cursor-not-allowed'); checkoutBtn.classList.add('bg-green-600', 'text-white'); }
                if(container) container.innerHTML = state.cart.map(item => `<div class="flex gap-5 items-start group animate-fade-in"><div class="w-20 h-20 rounded-2xl overflow-hidden bg-card shrink-0 mt-1 border border-border"><img src="${item.image}" class="w-full h-full object-cover opacity-90 group-hover:opacity-100 transition-opacity" onerror="this.src='https://placehold.co/100x100/1a1a1a/red?text=Erro'"></div><div class="flex-1"><div class="flex justify-between items-start mb-1"><h4 class="font-bold text-foreground text-lg leading-tight">${item.name}</h4><button onclick="removeFromCart('${item.uniqueId}')" class="text-muted-foreground hover:text-destructive transition-colors"><i data-lucide="trash-2" class="w-4 h-4"></i></button></div>${item.selectedOptions && item.selectedOptions.length > 0 ? `<div class="flex flex-wrap gap-1 mb-2">` + item.selectedOptions.map(opt => `<span class="text-xs text-muted-foreground bg-secondary px-2 py-0.5 rounded border border-border">${opt.name}</span>`).join('') + `</div>` : ''}<p class="text-primary font-bold mb-3">R$ ${(item.price * item.quantity).toFixed(2)}</p><div class="flex items-center gap-4 bg-secondary w-max px-3 py-1.5 rounded-lg border border-border"><button onclick="updateQuantity('${item.uniqueId}', -1)" class="text-muted-foreground hover:text-destructive text-lg leading-none pb-0.5">-</button><span class="text-sm font-bold text-foreground w-4 text-center">${item.quantity}</span><button onclick="updateQuantity('${item.uniqueId}', 1)" class="text-muted-foreground hover:text-green-500 text-lg leading-none pb-0.5">+</button></div></div></div>`).join(''); 
             }
             lucide.createIcons();
        }

        function checkoutWhatsApp() { if (state.cart.length === 0) return; const clientName = prompt("Por favor, digite seu nome:"); if (!clientName) return; let address = ""; if (!state.currentTable) { address = prompt("Por favor, digite seu endereço completo para entrega:"); if (!address) return; } state.pendingCheckout = { clientName: clientName, address: address }; const paymentModal = document.getElementById('payment-modal'); const paymentContent = document.getElementById('payment-modal-content'); paymentModal.classList.remove('hidden'); setTimeout(() => { paymentContent.classList.remove('scale-95', 'opacity-0'); paymentContent.classList.add('scale-100', 'opacity-100'); }, 10); }
        function closePaymentModal() { const paymentModal = document.getElementById('payment-modal'); const paymentContent = document.getElementById('payment-modal-content'); paymentContent.classList.remove('scale-100', 'opacity-100'); paymentContent.classList.add('scale-95', 'opacity-0'); setTimeout(() => { paymentModal.classList.add('hidden'); }, 300); }
        function finalizeOrder(paymentMethod) {
            const { clientName, address } = state.pendingCheckout; const total = state.cart.reduce((acc, item) => acc + (item.price * item.quantity), 0);
            const newOrder = { id: Math.floor(Math.random() * 10000) + 1000, date: new Date().toISOString(), total: total, status: 'Pendente', items: JSON.parse(JSON.stringify(state.cart)), table: state.currentTable, clientName: clientName, address: address, paymentMethod: paymentMethod };
            state.orders.unshift(newOrder);
            let message = ""; if(state.currentTable) { message += `📍 *PEDIDO MESA ${state.currentTable} - BLACK BURGER*\n`; } else { message += "🛵 *NOVO PEDIDO DELIVERY - BLACK BURGER*\n"; } message += `👤 *Cliente:* ${clientName}\n`; if (address) message += `📍 *Endereço:* ${address}\n`; message += `\n🛒 *RESUMO DO PEDIDO:*\n`; state.cart.forEach(item => { message += `▪️ ${item.quantity}x ${item.name}`; if (item.selectedOptions && item.selectedOptions.length > 0) { message += ` (${item.selectedOptions.map(opt => opt.name).join(', ')})`; } message += `\n`; }); message += `\n💰 *Total: R$ ${total.toFixed(2)}*`; message += `\n💳 *Pagamento:* ${paymentMethod}`;
            window.open(`https://wa.me/5584999780963?text=${encodeURIComponent(message)}`, '_blank');
            state.cart = []; state.pendingCheckout = null; saveData(); renderCart(); toggleCart(); closePaymentModal();
        }

        // ... (Admin Logic: renderCategoryOptions, addNewCategory, renderCategories, editProduct, handleSaveProduct, etc already updated above) ...
        function toggleLoginModal() { const modal = document.getElementById('login-modal'); if (modal.classList.contains('hidden')) { modal.classList.remove('hidden'); } else { modal.classList.add('hidden'); document.getElementById('login-user').value = ''; document.getElementById('login-pass').value = ''; } }
        function handleLogin(e) { e.preventDefault(); const user = document.getElementById('login-user').value; const pass = document.getElementById('login-pass').value; if (user === 'admin' && pass === 'admin') { state.isAdminLoggedIn = true; toggleLoginModal(); toggleAdminDashboard(); } else { alert("Credenciais inválidas!"); } }
        function toggleAdminDashboard() { const dashboard = document.getElementById('admin-dashboard'); if (state.isAdminLoggedIn) { if (dashboard.classList.contains('hidden')) { dashboard.classList.remove('hidden'); switchAdminView('products'); } else { dashboard.classList.add('hidden'); state.isAdminLoggedIn = false; } } else { dashboard.classList.add('hidden'); } }
        function switchAdminView(view) {
            state.adminView = view;
            const tabProducts = document.getElementById('tab-products');
            const tabOrders = document.getElementById('tab-orders');
            const tabQR = document.getElementById('tab-qr');
            const tabPromos = document.getElementById('tab-promos');
            const tabHours = document.getElementById('tab-hours');
            const tabInsights = document.getElementById('tab-insights');
            
            const viewProducts = document.getElementById('admin-view-products');
            const viewOrders = document.getElementById('admin-view-orders');
            const viewQR = document.getElementById('admin-view-qr');
            const viewPromos = document.getElementById('admin-view-promos');
            const viewHours = document.getElementById('admin-view-hours');
            const viewInsights = document.getElementById('admin-view-insights');

            [tabProducts, tabOrders, tabQR, tabPromos, tabHours, tabInsights].forEach(tab => {
                tab.classList.remove('border-primary', 'text-primary');
                tab.classList.add('border-transparent', 'text-muted-foreground');
            });
            [viewProducts, viewOrders, viewQR, viewPromos, viewHours, viewInsights].forEach(v => v.classList.add('hidden'));

            if (view === 'products') {
                tabProducts.classList.add('border-primary', 'text-primary');
                tabProducts.classList.remove('border-transparent', 'text-muted-foreground');
                viewProducts.classList.remove('hidden');
                renderAdminList();
            } else if (view === 'orders') {
                tabOrders.classList.add('border-primary', 'text-primary');
                tabOrders.classList.remove('border-transparent', 'text-muted-foreground');
                viewOrders.classList.remove('hidden');
                renderAdminOrders();
            } else if (view === 'qr') {
                tabQR.classList.add('border-primary', 'text-primary');
                tabQR.classList.remove('border-transparent', 'text-muted-foreground');
                viewQR.classList.remove('hidden');
            } else if (view === 'promos') {
                tabPromos.classList.add('border-primary', 'text-primary');
                tabPromos.classList.remove('border-transparent', 'text-muted-foreground');
                viewPromos.classList.remove('hidden');
                renderAdminPromos();
            } else if (view === 'hours') {
                tabHours.classList.add('border-primary', 'text-primary');
                tabHours.classList.remove('border-transparent', 'text-muted-foreground');
                viewHours.classList.remove('hidden');
                renderAdminHours();
            } else if (view === 'insights') {
                tabInsights.classList.add('border-primary', 'text-primary');
                tabInsights.classList.remove('border-transparent', 'text-muted-foreground');
                viewInsights.classList.remove('hidden');
            }
        }
        function renderAdminList() {
            const tbody = document.getElementById('admin-products-list');
            const badge = document.getElementById('total-items-badge');
            badge.innerText = `${state.menu.length} itens`;
            tbody.innerHTML = state.menu.map(item => `
                <tr class="hover:bg-accent/50 transition-colors group ${item.active === false ? 'opacity-50' : ''}">
                    <td class="p-4 pl-6"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-lg overflow-hidden border border-border"><img src="${item.image}" class="w-full h-full object-cover" onerror="this.src='https://placehold.co/100x100/1a1a1a/red?text=Erro'"></div><span class="font-bold text-foreground">${item.name}</span></div></td>
                    <td class="p-4 text-muted-foreground">${item.category}</td>
                    <td class="p-4 font-bold text-foreground">R$ ${item.price.toFixed(2)}</td>
                    <td class="p-4 pr-6 text-right"><div class="flex justify-end gap-2"><button onclick="toggleProductActive(${item.id})" class="p-2 ${item.active !== false ? 'bg-green-500/10 text-green-600' : 'bg-muted text-muted-foreground'} rounded-lg hover:opacity-80 transition-colors"><i data-lucide="${item.active !== false ? 'eye' : 'eye-off'}" class="w-4 h-4"></i></button><button onclick="editProduct(${item.id})" class="p-2 bg-blue-500/10 text-blue-600 rounded-lg hover:bg-blue-500/20 transition-colors"><i data-lucide="pencil" class="w-4 h-4"></i></button><button onclick="openDeleteModal(${item.id})" class="p-2 bg-destructive/10 text-destructive rounded-lg hover:bg-destructive/20 transition-colors"><i data-lucide="trash-2" class="w-4 h-4"></i></button></div></td>
                </tr>`).join('');
            lucide.createIcons();
        }
        function toggleProductActive(id) { const product = state.menu.find(p => p.id === id); if (product) { product.active = product.active === false; renderAdminList(); renderMenu(); renderBestSellers(); renderPromoSection(); } }
        function openDeleteModal(id) { state.productToDeleteId = id; document.getElementById('delete-confirmation-modal').classList.remove('hidden'); }
        function closeDeleteModal() { state.productToDeleteId = null; document.getElementById('delete-confirmation-modal').classList.add('hidden'); }
        function confirmDeleteProduct() { if (state.productToDeleteId) { state.menu = state.menu.filter(p => p.id !== state.productToDeleteId); renderAdminList(); renderMenu(); renderBestSellers(); renderPromoSection(); } closeDeleteModal(); }
        function resetForm() { document.querySelector('form').reset(); document.getElementById('edit-id').value = ''; document.getElementById('form-title').innerText = "Adicionar Novo Item"; document.getElementById('save-btn').innerHTML = `<i data-lucide="save" class="w-4 h-4"></i> SALVAR PRODUTO`; document.getElementById('admin-tag-spicy').checked = false; document.getElementById('admin-tag-vegan').checked = false; document.getElementById('admin-tag-gluten_free').checked = false; document.getElementById('admin-promo').checked = false; lucide.createIcons(); }
        function initTheme() { if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) { document.documentElement.classList.add('dark'); updateThemeIcon(true); } else { document.documentElement.classList.remove('dark'); updateThemeIcon(false); } }
        function toggleTheme() { if (document.documentElement.classList.contains('dark')) { document.documentElement.classList.remove('dark'); localStorage.theme = 'light'; updateThemeIcon(false); } else { document.documentElement.classList.add('dark'); localStorage.theme = 'dark'; updateThemeIcon(true); } }
        function updateThemeIcon(isDark) { const icon = document.getElementById('theme-icon'); icon.setAttribute('data-lucide', isDark ? 'sun' : 'moon'); lucide.createIcons(); }

        // QR Code functions
        function generateQRCode() {
            const num = document.getElementById('qr-table-num').value;
            if(!num) return alert("Digite o número da mesa!");
            const container = document.getElementById('qrcode-container');
            container.innerHTML = ""; 
            const baseUrl = window.location.href.split('?')[0]; 
            const finalUrl = `${baseUrl}?mesa=${num}`;
            new QRCode(container, { text: finalUrl, width: 200, height: 200, colorDark : "#000000", colorLight : "#ffffff", correctLevel : QRCode.CorrectLevel.H });
            document.getElementById('qr-display-num').innerText = num;
            document.getElementById('qr-result-area').classList.remove('hidden');
        }
        function printQRCode() {
            const printWindow = window.open('', '', 'height=600,width=800');
            const qrHTML = document.getElementById('qrcode-container').innerHTML;
            const num = document.getElementById('qr-display-num').innerText;
            printWindow.document.write('<html><head><title>Mesa ' + num + '</title></head><body style="text-align:center; font-family:sans-serif;"><h1>Mesa ' + num + '</h1><div style="display:inline-block; margin:20px;">' + qrHTML + '</div><p>Escaneie para pedir</p></body></html>');
            printWindow.document.close();
            printWindow.print();
        }

        // Admin Order View Functions
        function renderAdminOrders() {
            // ... (Existing Logic for rendering orders with filters) ...
            const list = document.getElementById('admin-orders-list');
            const filterStatus = document.getElementById('order-filter-status').value;
            const filterStart = document.getElementById('order-filter-start').value;
            const filterEnd = document.getElementById('order-filter-end').value;

            let filteredOrders = state.orders.filter(o => {
                const oDate = new Date(o.date);
                const matchStatus = filterStatus === 'all' || o.status === filterStatus;
                let matchDate = true;
                if (filterStart) { const parts = filterStart.split('-'); const start = new Date(parts[0], parts[1] - 1, parts[2]); matchDate = matchDate && oDate >= start; }
                if (filterEnd) { const parts = filterEnd.split('-'); const end = new Date(parts[0], parts[1] - 1, parts[2]); end.setHours(23, 59, 59, 999); matchDate = matchDate && oDate <= end; }
                return matchStatus && matchDate;
            });
            // Stats
            const totalRevenue = filteredOrders.reduce((sum, o) => sum + o.total, 0);
            const totalCount = filteredOrders.length;
            const avgTicket = totalCount > 0 ? totalRevenue / totalCount : 0;
            const deliveredCount = filteredOrders.filter(o => o.status === 'Entregue').length;
            const conversionRate = totalCount > 0 ? (deliveredCount / totalCount) * 100 : 0;

            document.getElementById('dash-total-revenue').innerText = `R$ ${totalRevenue.toFixed(2)}`;
            document.getElementById('dash-total-count').innerText = totalCount;
            document.getElementById('dash-avg-ticket').innerText = `R$ ${avgTicket.toFixed(2)}`;
            document.getElementById('dash-conversion').innerText = `${conversionRate.toFixed(0)}%`;

            if (filteredOrders.length === 0) { list.innerHTML = ''; document.getElementById('no-orders-msg').classList.remove('hidden'); return; }
            document.getElementById('no-orders-msg').classList.add('hidden');

            const statusStyles = { 'Pendente': 'bg-yellow-100 text-yellow-800 border-yellow-200 dark:bg-yellow-900/30 dark:text-yellow-400 dark:border-yellow-900/50', 'Em Preparo': 'bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-400 dark:border-blue-900/50', 'Entregue': 'bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-400 dark:border-green-900/50', 'Cancelado': 'bg-red-100 text-red-800 border-red-200 dark:bg-red-900/30 dark:text-red-400 dark:border-red-900/50' };

            list.innerHTML = filteredOrders.map(order => {
                const itemsSummary = order.items.map(i => `${i.quantity}x ${i.name}`).join(', ');
                const itemsTruncated = itemsSummary.length > 40 ? itemsSummary.substring(0, 40) + '...' : itemsSummary;
                return `<tr class="hover:bg-accent/50 transition-colors border-b border-border last:border-0 group cursor-pointer" onclick="viewOrderDetails(${order.id})"><td class="p-5 pl-6"><span class="font-mono text-xs font-bold text-muted-foreground bg-secondary px-2 py-1 rounded">#${order.id}</span>${order.table ? `<span class="ml-2 bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400 px-1.5 py-0.5 rounded text-[10px]">Mesa ${order.table}</span>` : ''}</td><td class="p-5"><div class="text-sm font-bold text-foreground">${new Date(order.date).toLocaleDateString('pt-BR')}</div><div class="text-xs text-muted-foreground">${new Date(order.date).toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}</div></td><td class="p-5"><div class="text-sm font-medium text-muted-foreground">${itemsTruncated}</div><div class="text-xs text-muted-foreground mt-0.5">${order.items.length} itens</div></td><td class="p-5"><span class="font-bold text-foreground">R$ ${order.total.toFixed(2)}</span></td><td class="p-5"><div class="flex items-center gap-2"><span class="px-2.5 py-1 rounded-md text-[10px] uppercase font-bold tracking-wider border ${statusStyles[order.status] || 'bg-secondary text-muted-foreground border-border'}">${order.status}</span></div></td><td class="p-5 pr-6 text-right"><button class="w-8 h-8 rounded-full bg-secondary hover:bg-accent flex items-center justify-center text-muted-foreground hover:text-primary transition-colors shadow-sm"><i data-lucide="chevron-right" class="w-4 h-4"></i></button></td></tr>`;
            }).join('');
            lucide.createIcons();
        }
        function handleOrderFilter() { renderAdminOrders(); }
        function viewOrderDetails(orderId) {
            const order = state.orders.find(o => o.id === orderId);
            if (!order) return;
            state.selectedOrder = order;
            const tableText = order.table ? ` (Mesa ${order.table})` : '';
            document.getElementById('modal-order-id').innerText = `Pedido #${order.id}${tableText}`;
            document.getElementById('modal-order-date').innerText = new Date(order.date).toLocaleString('pt-BR');
            document.getElementById('modal-order-total').innerText = `R$ ${order.total.toFixed(2)}`;
            const itemsContainer = document.getElementById('modal-order-items');
            itemsContainer.innerHTML = order.items.map(item => `<div class="flex justify-between items-start border-b border-border pb-2 last:border-0"><div><span class="font-bold text-foreground text-sm">${item.quantity}x ${item.name}</span>${item.selectedOptions && item.selectedOptions.length > 0 ? `<div class="text-xs text-muted-foreground mt-1">${item.selectedOptions.map(o => o.name).join(', ')}</div>` : ''}</div><span class="text-sm font-bold text-muted-foreground">R$ ${(item.price * item.quantity).toFixed(2)}</span></div>`).join('');
            document.getElementById('order-details-modal').classList.remove('hidden');
        }
        function toggleOrderDetails() { document.getElementById('order-details-modal').classList.add('hidden'); state.selectedOrder = null; }
        function updateOrderStatusFromModal(newStatus) { if (!state.selectedOrder) return; state.selectedOrder.status = newStatus; viewOrderDetails(state.selectedOrder.id); renderAdminOrders(); toggleOrderDetails(); saveData(); }

        // --- NEW: Render Admin Promos Table ---
        function renderAdminPromos() {
            const tbody = document.getElementById('admin-promos-list');
            tbody.innerHTML = state.menu.map(item => `
                <tr class="hover:bg-accent/50 transition-colors border-b border-border last:border-0">
                    <td class="p-5 pl-6">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg overflow-hidden border border-border"><img src="${item.image}" class="w-full h-full object-cover"></div>
                            <span class="font-bold text-foreground">${item.name}</span>
                        </div>
                    </td>
                    <td class="p-5 text-muted-foreground">R$ ${item.price.toFixed(2)}</td>
                    <td class="p-5">
                        <input type="number" step="0.10" value="${item.promoPrice || 0}" 
                            class="w-24 bg-input border border-border rounded-lg px-2 py-1 text-sm text-foreground focus:border-primary outline-none"
                            onchange="updatePromoPrice(${item.id}, this.value)"
                        >
                    </td>
                    <td class="p-5">
                        <label class="inline-flex items-center cursor-pointer">
                            <input type="checkbox" class="sr-only peer" ${item.promo ? 'checked' : ''} onchange="togglePromoStatus(${item.id})">
                            <div class="relative w-11 h-6 bg-input border-border peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                            <span class="ms-3 text-sm font-medium text-foreground">${item.promo ? 'Ativo' : 'Inativo'}</span>
                        </label>
                    </td>
                    <td class="p-5 pr-6 text-right text-xs text-muted-foreground">
                        ${item.promo ? 'Exibindo na Loja' : '-'}
                    </td>
                </tr>
            `).join('');
        }
        // --- NEW: Render Promo Section ---
        function renderPromoSection() {
            const container = document.getElementById('special-promos-grid');
            const section = document.getElementById('special-promos-section');
            const promos = state.menu.filter(p => p.promo === true && p.active !== false).slice(0, 3);

            if (promos.length === 0) {
                section.classList.add('hidden');
                return;
            }
            section.classList.remove('hidden');

            container.innerHTML = promos.map(item => `
                <div onclick="openDetails(${item.id})" class="flex-shrink-0 w-72 bg-card rounded-2xl p-4 border border-primary/30 cursor-pointer hover:scale-[1.02] transition-transform relative group shadow-md hover:shadow-lg">
                    <div class="absolute -top-3 -right-3 bg-red-600 text-white font-black text-xs px-3 py-1 rounded-full shadow-lg animate-bounce z-10">
                        OFERTA
                    </div>
                    <div class="h-40 rounded-xl overflow-hidden mb-4 relative">
                        <img src="${item.image}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" alt="${item.name}">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                        <div class="absolute bottom-2 left-2 right-2 text-white">
                            <p class="font-bold text-lg leading-tight drop-shadow-md">${item.name}</p>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <div class="flex flex-col">
                            <span class="text-xs text-muted-foreground line-through">R$ ${item.price.toFixed(2)}</span>
                            <span class="text-xl font-black text-red-600 dark:text-red-500">R$ ${(item.promoPrice || item.price).toFixed(2)}</span>
                        </div>
                        <button class="bg-primary hover:bg-primary/90 text-primary-foreground p-2 rounded-full shadow-lg transition-colors">
                            <i data-lucide="plus" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function updatePromoPrice(id, value) {
            const item = state.menu.find(p => p.id === id);
            if(item) {
                item.promoPrice = parseFloat(value);
                saveData();
                renderPromoSection();
                renderMenu();
            }
        }

        function togglePromoStatus(id) {
            const item = state.menu.find(p => p.id === id);
            if(item) {
                item.promo = !item.promo;
                saveData();
                renderAdminPromos();
                renderPromoSection();
                renderMenu(); 
            }
        }

        // --- NEW: Helper Functions for Search Mode ---
        function handleSearch(value) {
            state.searchTerm = value;
            openSearchMode();
            renderBestSellers();
            renderMenu();
        }

        function openSearchMode() {
            document.getElementById('search-filters-wrapper').classList.remove('hidden');
            document.getElementById('search-close-btn').classList.remove('hidden');
        }

        function closeSearchMode() {
            document.getElementById('search-filters-wrapper').classList.add('hidden');
            document.getElementById('search-close-btn').classList.add('hidden');
            document.getElementById('search-input').value = '';
            state.searchTerm = '';
            state.filter = 'Todos';
            state.activeTag = null;
            renderCategories();
            renderFilters();
            renderBestSellers();
            renderMenu();
        }

        // --- NEW: IA INSIGHTS FUNCTIONALITY ---
        async function fetchAIInsights() {
            const btn = document.getElementById('btn-generate-insights');
            const loading = document.getElementById('insights-loading');
            const resultArea = document.getElementById('insights-result');
            
            btn.classList.add('opacity-50', 'pointer-events-none');
            loading.classList.remove('hidden');
            resultArea.classList.add('hidden');

            const menuSummary = state.menu.slice(0, 10).map(i => ({ name: i.name, price: i.price, category: i.category }));
            
            const prompt = `Analise este cardápio de hamburgueria: ${JSON.stringify(menuSummary)}. Crie 6 insights estratégicos baseados em dados (formato visual com emojis):
            1. 🍟 Combos sugeridos (Aumentar ticket médio)
            2. 🌟 Destaques de hoje (Margem/conversão)
            3. ⚠️ Risco de prejuízo (Baixa venda/alto custo)
            4. 🕰️ Horários mortos (Ações para baixa demanda)
            5. 🗺️ Mapa de atenção (Otimização do menu)
            6. 💲 Sugestão de preço (Ajustes de valor)
            Responda apenas com o conteúdo, bem formatado.`;

            try {
                // Using Groq API with provided key
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer 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'
                    },
                    body: JSON.stringify({ 
                        model: "llama3-70b-8192",
                        messages: [{ role: "user", content: prompt }]
                    })
                });

                if (!response.ok) {
                     throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.choices && data.choices.length > 0) {
                    renderInsightsResult(data.choices[0].message.content);
                } else {
                    console.error('AI API Error:', data);
                    // Fallback
                    renderInsightsResult("⚠️ **Nota:** A IA está indisponível no momento. Aqui estão insights baseados em regras:\n\n### 1. 🍟 Combos sugeridos\n* **Monster Bacon + Fritas:** Aumenta ticket em 15%.\n* **Smash Duplo + Coca Zero:** Alta saída conjunta.\n\n### 2. 🌟 Destaques de hoje\n* **Classic Salad:** Margem alta, ideal para hoje.\n\n### 3. ⚠️ Risco de prejuízo\n* **Dark Chicken:** Custo subiu, rever preço.\n\n### 4. 🕰️ Horários mortos\n* **15h - 17h:** Baixo movimento. Criar 'Happy Hour'.\n\n### 5. 🗺️ Mapa de atenção\n* Mover **Bebidas** para o topo do cardápio mobile.\n\n### 6. 💲 Sugestão de preço\n* Aumentar **Fritas Rústicas** em R$ 1,00 (demanda inelástica).");
                }
            } catch (error) {
                console.error('AI Network Error:', error);
                // Fallback
                renderInsightsResult("⚠️ **Nota:** Modo Offline (IA indisponível). Análise local:\n\n### 1. 🍟 Combos sugeridos\n* **Monster Bacon + Fritas:** Aumenta ticket em 15%.\n* **Smash Duplo + Coca Zero:** Alta saída conjunta.\n\n### 2. 🌟 Destaques de hoje\n* **Classic Salad:** Margem alta, ideal para hoje.\n\n### 3. ⚠️ Risco de prejuízo\n* **Dark Chicken:** Custo subiu, rever preço.\n\n### 4. 🕰️ Horários mortos\n* **15h - 17h:** Baixo movimento. Criar 'Happy Hour'.\n\n### 5. 🗺️ Mapa de atenção\n* Mover **Bebidas** para o topo do cardápio mobile.\n\n### 6. 💲 Sugestão de preço\n* Aumentar **Fritas Rústicas** em R$ 1,00 (demanda inelástica).");
            } finally {
                btn.classList.remove('opacity-50', 'pointer-events-none');
                loading.classList.add('hidden');
            }
        }

        function renderInsightsResult(text) {
            const resultArea = document.getElementById('insights-result');
            // Format markdown-like text to HTML for better display
            const formattedText = text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold
                .replace(/\n/g, '<br>'); // Line breaks

            resultArea.innerHTML = `
                <div class="col-span-1 md:col-span-3 bg-card p-6 rounded-2xl border border-border shadow-lg">
                    <div class="prose dark:prose-invert ai-response-content text-sm md:text-base leading-relaxed text-foreground">
                        ${formattedText}
                    </div>
                </div>
            `;
            resultArea.classList.remove('hidden');
        }

        // Ensure editProduct is defined here
        function editProduct(id) {
            const item = state.menu.find(p => p.id === id);
            if (!item) return;
            document.getElementById('edit-id').value = item.id;
            document.getElementById('admin-name').value = item.name;
            document.getElementById('admin-price').value = item.price;
            document.getElementById('admin-image').value = item.image;
            document.getElementById('admin-desc').value = item.description;
            document.getElementById('admin-cat').value = item.category;

            // Tags
            document.getElementById('admin-tag-spicy').checked = item.tags && item.tags.includes('spicy');
            document.getElementById('admin-tag-vegan').checked = item.tags && item.tags.includes('vegan');
            document.getElementById('admin-tag-gluten_free').checked = item.tags && item.tags.includes('gluten_free');
            
            // PROMO
            document.getElementById('admin-promo').checked = !!item.promo;

            document.getElementById('form-title').innerText = "Editar Item";
            document.getElementById('save-btn').innerHTML = `<i data-lucide="refresh-cw" class="w-4 h-4"></i> ATUALIZAR`;
            const dashboard = document.getElementById('admin-dashboard');
            dashboard.scrollTo({ top: 0, behavior: 'smooth' });
            lucide.createIcons();
        }
        
        function handleSaveProduct(e) {
            e.preventDefault();
            const id = document.getElementById('edit-id').value;
            const name = document.getElementById('admin-name').value;
            const price = parseFloat(document.getElementById('admin-price').value);
            let image = document.getElementById('admin-image').value;
            const desc = document.getElementById('admin-desc').value;
            const cat = document.getElementById('admin-cat').value;
            
            if (image && image.includes('imgur.com') && !image.includes('i.imgur.com')) {
                 const match = image.match(/imgur\.com\/([a-zA-Z0-9]{5,})/);
                 if (match && match[1] && !image.includes('/a/') && !image.includes('/gallery/')) { image = `https://i.imgur.com/${match[1]}.jpg`; }
            }

            const tags = [];
            if (document.getElementById('admin-tag-spicy').checked) tags.push('spicy');
            if (document.getElementById('admin-tag-vegan').checked) tags.push('vegan');
            if (document.getElementById('admin-tag-gluten_free').checked) tags.push('gluten_free');
            
            const isPromo = document.getElementById('admin-promo').checked;

            if (id) {
                const index = state.menu.findIndex(p => p.id == id);
                if (index !== -1) {
                    state.menu[index] = {
                        ...state.menu[index],
                        name, price, image, description: desc, category: cat, tags: tags, promo: isPromo
                    };
                }
            } else {
                const newProduct = {
                    id: Date.now(),
                    name, 
                    description: desc,
                    price,
                    category: cat,
                    image: image || "https://placehold.co/400x300/1a1a1a/red?text=Sem+Imagem",
                    rating: 5.0, 
                    tags: tags, 
                    promo: isPromo, // Save promo
                    options: [],
                    active: true 
                };
                state.menu.push(newProduct);
            }

            saveData();
            resetForm();
            renderAdminList();
            renderMenu();
            renderBestSellers();
            renderPromoSection(); // Refresh promos
            alert("Cardápio atualizado com sucesso!");
        }

        // --- CORREÇÃO DA ABA HORÁRIOS ---
        function renderAdminHours() {
            const container = document.getElementById('hours-config-container');
            if (!container) return; // Segurança contra o erro anterior (admin-content)
            
            container.innerHTML = Object.keys(state.openingHours).map(day => `
                <div class="flex items-center justify-between p-4 bg-secondary rounded-2xl border border-transparent hover:border-primary/20 transition-all">
                    <span class="font-bold text-sm w-20 text-foreground">${day}</span>
                    <div class="flex items-center gap-2">
                        <input type="time" value="${state.openingHours[day].open}" onchange="updateHour('${day}', 'open', this.value)" class="bg-background text-foreground border border-border p-2 rounded-lg text-xs font-medium outline-none focus:border-primary">
                        <span class="text-muted-foreground text-xs">até</span>
                        <input type="time" value="${state.openingHours[day].close}" onchange="updateHour('${day}', 'close', this.value)" class="bg-background text-foreground border border-border p-2 rounded-lg text-xs font-medium outline-none focus:border-primary">
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer ml-4">
                        <input type="checkbox" ${state.openingHours[day].active ? 'checked' : ''} onchange="updateHour('${day}', 'active', this.checked)" class="sr-only peer">
                        <div class="w-9 h-5 bg-input peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-primary"></div>
                    </label>
                </div>
            `).join('');
        }

        function updateHour(day, key, val) {
            state.openingHours[day][key] = val;
        }

        function saveHours() {
            saveData();
            renderOpeningHoursTag();
            alert('Horários de funcionamento atualizados com sucesso!');
        }
    </script>
</body>
</html>